/*! baqend 0.9.1 | Copyright (c) 2015 Baqend GmbH | MIT */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.DB=e()}}(function(){var e;return function f(e,n,o){function d(t,l){if(!n[t]){if(!e[t]){var u="function"==typeof require&&require;if(!l&&u)return u(t,!0);if(i)return i(t,!0);var p=new Error("Cannot find module '"+t+"'");throw p.code="MODULE_NOT_FOUND",p}var s=n[t]={exports:{}};e[t][0].call(s.exports,function(f){var n=e[t][1][f];return d(n?n:f)},s,s.exports,f,e,n,o)}return n[t].exports}for(var i="function"==typeof require&&require,t=0;t<o.length;t++)d(o[t]);return d}({1:[function(e,f){var n=e("./message"),o=e("./error"),d=e("./EntityTransaction"),i=e("./Query"),t=e("./util/Validator"),l=e("./util/ValidationResult"),u=e("./util/Lockable"),p=e("./util/Metadata"),s=e("./util").uuid,y=e("./connector/Message").StatusCode,c=Object.inherit(u,{List:e("./collection").List,Set:e("./collection").Set,Map:e("./collection").Map,GeoPoint:e("./GeoPoint"),entityManagerFactory:null,metamodel:null,code:null,_connector:null,_entities:null,get isOpen(){return!!this._connector},token:null,me:null,isGlobal:!1,run:function(e,f,n,o){return Function.isInstance(f)&&(o=n,n=f,f=null),this.code.callCode(e,f,this.token,this).then(n,o)},constructor:function(e,f){this.entityManagerFactory=e,this.metamodel=e.metamodel,this.code=e.code,this.isGlobal=!!f,this.lock()},connected:function(e){if(this._connector=e,this._entities={},this._createObjectFactory(this.metamodel.embeddables),this._createObjectFactory(this.metamodel.entities),this.transaction=new d(this),this.isGlobal){var f=new n.Me;return f.withAuthorizationToken(),this._userRequest(f).then(function(){this.unlock()}.bind(this))}this.unlock()},_createObjectFactory:function(e){Object.keys(e).forEach(function(e){var f=this.metamodel.managedType(e),n=f.name;this[n]?(f.typeConstructor=this[n],Object.defineProperty(this,n,{value:f.createObjectFactory(this)})):Object.defineProperty(this,n,{get:function(){return Object.defineProperty(this,n,{value:f.createObjectFactory(this)}),this[n]},set:function(e){f.typeConstructor=e},configurable:!0})},this)},_send:function(e,f){return e.withAuthorizationToken(this.token),this._connector.send(e).then(function(){var n=e.getAuthorizationToken();return n&&!f&&(this.token=n),e}.bind(this))},getReference:function(e,f){if(String.isInstance(e)&&!f){var n=e.lastIndexOf("/");f=decodeURIComponent(e.substring(n+1)),e=e.substring(0,n)}var o=this.metamodel.entity(e),d=this._entities[o.ref+"/"+encodeURIComponent(f)];if(!d){d=o.create();var i=p.get(d);i.id=f,i.setUnavailable(),this._attach(d)}return d},createQueryBuilder:function(e){return new i.Builder(this,e)},clear:function(){return this["yield"]().then(function(){for(var e in this._entities)this.removeReference(this._entities[e])}.bind(this))},close:function(e,f){return this._connector=null,this.clear(e,f)},contains:function(e){var f=p.get(e);return!!f&&this._entities[f.ref]===e},containsById:function(e){var f=this.metamodel.entity(e.constructor),n=f.ref+"/"+e.id;return!!this._entities[n]},detach:function(e){var f=p.get(e);if(!f)throw new o.IllegalEntityError(e);return f.withLock(function(){return this.removeReference(e),Promise.resolve(e)})},load:function(e,f,o){o=o||{},o.resolved=o.resolved||[];var d=this.getReference(e,f),i=p.get(d),t=new n.GetObject(i.bucket,i.id);return(i.version||o.reload)&&t.setIfNoneMatch(o.reload?"":i.version),this._send(t).then(function(e){e.response.statusCode!=y.NOT_MODIFIED&&i.setDatabaseObject(e.response.entity),i.setPersistent();var f=[];if(o.depth){var n=Object.extend({},o);n.depth=o.depth===!0?!0:o.depth-1,this.getSubEntities(d,1).forEach(function(e){if(!~o.resolved.indexOf(e)){o.resolved.push(e);var d=p.get(e);f.push(this.load(e.constructor,d.id,n))}}.bind(this))}return Promise.all(f).then(function(){return d})}.bind(this),function(e){if(e.statusCode==y.OBJECT_NOT_FOUND)return this.removeReference(d),i.setRemoved(),null;throw e}.bind(this))},insert:function(e,f){f=f||{};var o;return this._save(e,f,function(e){if(e.version)throw new Error("Existing objects can't be inserted.");return o=!e.id,new n.CreateObject(e.bucket,e.getDatabaseObject())}).then(function(f){return o&&this._attach(e),f}.bind(this))},update:function(e,f){return f=f||{},this._save(e,f,function(e){if(!e.version)throw new Error("New objects can't be inserted.");if(f.force){var o=new n.ReplaceObject(e.bucket,e.id,e.getDatabaseObject(!0));return o.setIfMatch("*"),o}return o=new n.ReplaceObject(e.bucket,e.id,e.getDatabaseObject(!1)),o.setIfMatch(e.version),o})},save:function(e,f){return f=f||{},this._save(e,f,function(e){if(f.force){if(!e.id)throw new Error("New special objects can't be forcedly saved.");return new n.ReplaceObject(e.bucket,e.id,e.getDatabaseObject(!0))}if(e.version){var o=new n.ReplaceObject(e.bucket,e.id,e.getDatabaseObject(!1));return o.setIfMatch(e.version),o}return new n.CreateObject(e.bucket,e.getDatabaseObject())})},_save:function(e,f,n){this.attach(e);var o=p.get(e);return o.withLock(function(){var d;if(o.isDirty){f.reload||o.setPersistent();var i=this._send(n(o)).then(function(n){return f.reload?(o.setDatabaseObject(n.response.entity),o.setPersistent()):o.setDatabaseObjectInfo(n.response.entity._objectInfo),e}.bind(this),function(f){if(f.statusCode==y.OBJECT_NOT_FOUND)return this.removeReference(e),o.setRemoved(),null;throw o.setDirty(),f}.bind(this));d=[i]}else d=[Promise.resolve(e)];var t=Object.extend({},f);return t.depth=0,this.getSubEntities(e,f.depth).forEach(function(e){d.push(this._save(e,t,n))}.bind(this)),Promise.all(d).then(function(){return e})}.bind(this))},getSubEntities:function(e,f,n,o){if(n=n||[],!f)return n;o=o||e;for(var d=p.get(e),i=d.type.references(),t=i.next();!t.done;t=i.next())this.getSubEntitiesByPath(e,t.value.path).forEach(function(e){~n.indexOf(e)||e==o||(n.push(e),n=this.getSubEntities(e,f===!0?f:f-1,n,o))}.bind(this));return n},getSubEntitiesByPath:function(e,f){var n=[e];return f.forEach(function(e){var f=[];n.forEach(function(n){var o=n[e];if(o){var d=this.metamodel.managedType(n.constructor).getAttribute(e);if(d.isCollection)for(var i,t=o.entries();!(i=t.next()).done;)f.push(i.value[1]),d.keyType&&d.keyType.isEntity&&f.push(i.value[0]);else f.push(o)}}.bind(this)),n=f}.bind(this)),n},"delete":function(e,f){f=f||{},this.attach(e);var d=p.get(e);return d.withLock(function(){if(!d.version&&!f.force)throw new o.IllegalEntityError(e);var i=new n.DeleteObject(d.bucket,d.id,d.getDatabaseObjectInfo(f.force));f.force||i.setIfMatch(d.version);var t=[this._send(i).then(function(){return this.removeReference(e),d.setRemoved(),e}.bind(this))],l=Object.extend({},f);return l.depth=0,this.getSubEntities(e,f.depth).forEach(function(e){t.push(this["delete"](e,l))}.bind(this)),Promise.all(t).then(function(){return e})}.bind(this))},flush:function(){},persist:function(e){e.attach(this)},reload:function(e,f){return f=f||{},f.reload=!0,this.load(e.constructor,e._metadata.id,f)},attach:function(e){if(!this.contains(e)){var f=this.metamodel.entity(classOf(e));if(!f)throw new o.IllegalEntityError(e);if(this.containsById(e))throw new o.EntityExistsError(e);this._attach(e)}},_attach:function(e){var f=p.get(e);if(f.isAttached){if(f.db!=this)throw new o.EntityExistsError(e)}else f.db=this;f.id||"User"!=f.type.name&&"Role"!=f.type.name&&(f.id=s()),f.id&&(this._entities[f.ref]=e)},removeReference:function(e){var f=p.get(e);if(!f)throw new o.IllegalEntityError(e);delete this._entities[f.ref]},register:function(e,f,o){if(this.me&&o)throw new Error("User is already logged in.");return this.withLock(function(){var d=new n.Register({user:e,password:f,global:this.isGlobal});return this._userRequest(d,o)}.bind(this))},login:function(e,f){if(this.me)throw new Error("User is already logged in.");return this.withLock(function(){var o=new n.Login({username:e,password:f,global:this.isGlobal});return this._userRequest(o)}.bind(this))},logout:function(){return this.withLock(function(){var e=function(){this.me=null,this.token=null}.bind(this);return this.isGlobal?this._send(new n.Logout).then(e):Promise.resolve(e())}.bind(this))},renew:function(){return this.withLock(function(){var e=new n.Me;return e.withAuthorizationToken(this.token),this._userRequest(e)}.bind(this))},newPassword:function(e,f,o){return this.withLock(function(){var d=new n.NewPassword({username:e,password:f,newPassword:o,global:this.isGlobal});return this._send(d).then(function(){var e=d.getAuthorizationToken();e&&(this.token=e);var f=d.response.entity._objectInfo.id,n=this.getReference("User",f),o=p.get(n);o.setDatabaseObject(d.response.entity),o.setPersistent()}.bind(this))}.bind(this))},_userRequest:function(e,f){return this._send(e,f).then(function(){var n=e.response.entity._objectInfo.id,o=this.getReference("User",n),d=p.get(o);return d.setDatabaseObject(e.response.entity),d.setPersistent(),f||(this.me=o),o}.bind(this),function(e){if(e.statusCode==y.OBJECT_NOT_FOUND)return null;throw e})},validate:function(e){for(var f=p.get(e).type,n=f.validationCode,o=[],d=new l,i=f.attributes(),u=i.next();!u.done;u=i.next()){var s=new t(u.value.name,e);o.push(s),d.fields[s.key]=s}return n&&n.apply({},o),d},User:null});f.exports=c},{"./EntityTransaction":3,"./GeoPoint":4,"./Query":5,"./collection":16,"./connector/Message":19,"./error":29,"./message":31,"./util":56,"./util/Lockable":51,"./util/Metadata":52,"./util/ValidationResult":54,"./util/Validator":55}],2:[function(e,f){var n=(e("./message"),e("./metamodel")),o=e("./util/Lockable"),d=e("./util/Code"),i=e("./connector/Connector"),t=e("./EntityManager"),l=Object.inherit(o,{_connector:null,metamodel:null,code:null,constructor:function(e){e=String.isInstance(e)?{host:e}:e||{},this.lock(),e.host&&this.connect(e.host,e.port,e.secure),this.metamodel=this.createMetamodel(e.global),this.code=this.createCode(),e.schema&&this.metamodel.init(e.schema)},connect:function(e,f,n){this._connector=i.create(e,f,n),this.unlock()},createMetamodel:function(e){var f=e?n:new n.Metamodel;return this.isReady?f.connected(this._connector):this.ready().then(function(e){f.connected(e._connector)}),f},createCode:function(){var e=new d;return this.isReady?e.connected(this._connector):this.ready().then(function(f){e.connected(f._connector)}),e},createEntityManager:function(e){var f=new t(this,e);return this.isReady&&this.metamodel.isInitialized?f.connected(this._connector):this.ready().then(function(){return this.metamodel.init()}.bind(this)).then(function(){f.connected(this._connector)}.bind(this)),f}});f.exports=l},{"./EntityManager":1,"./connector/Connector":17,"./message":31,"./metamodel":47,"./util/Code":50,"./util/Lockable":51}],3:[function(e,f){var n=e("./message"),o=e("./error"),d=Object.inherit({get isActive(){return Boolean(this.tid)},constructor:function(e){this._connector=e.connector,this.entityManager=e,this.tid=null,this.rollbackOnly=!1,this.readSet=null,this.changeSet=null},begin:function(e,f){return this["yield"]().then(function(){var e=this.send(new n.PostTransaction).done(function(e){this.tid=e.tid,this.rollbackOnly=!1,this.readSet={},this.changeSet={}});return this.wait(e)}).then(e,f)},commit:function(e,f){return this["yield"]().then(function(){return this.getRollbackOnly()?this.rollback().then(function(){throw new o.RollbackError}):this.wait(this.entityManager.flush()).then(function(){var e=[];for(var f in this.readSet)e.push({oid:f,version:this.readSet[f]});var o=this.send(new n.PutTransactionCommitted(this.tid,e));return this.wait(o).then(function(e){this.tid=null,this.readSet=null,this.changeSet=null;var f=e.oids;for(var n in f){var o=f[n],d=this.entityManager.entities[n];if(d){var i=util.Metadata.get(d);"DELETED"==o||i.isDeleted?this.entityManager.removeReference(d):i.setDatabaseValue(i.type.version,o)}}})})}).then(e,f)},getRollbackOnly:function(){return this.rollbackOnly},rollback:function(e,f){return this["yield"]().then(function(){var e=this.send(new n.PutTransactionAborted(this.tid));this.wait(e).then(function(){return this.tid=null,this.readSet=null,this.changeSet=null,this.entityManager.clear()},function(){return this.entityManager.clear()})}).then(e,f)},setRollbackOnly:function(){return this["yield"]().done(function(){this.rollbackOnly=!0})},isRead:function(e){return this.isActive&&e in this.readSet},setRead:function(e,f){this.isActive&&!this.isChanged(e)&&(this.readSet[e]=f)},isChanged:function(e){return this.isActive&&e in this.changeSet},setChanged:function(e){this.isActive&&(delete this.readSet[e],this.changeSet[e]=!0)}});f.exports=d},{"./error":29,"./message":31}],4:[function(e,f){var n=(e("./collection"),Object.inherit({extend:{DEG_TO_RAD:Math.PI/180,EARTH_RADIUS_IN_KILOMETERS:6371,EARTH_RADIUS_IN_MILES:3956,current:function(){return new Promise(function(e,f){navigator.geolocation.getCurrentPosition(function(f){e(new n(f.coords.latitude,f.coords.longitude))},function(e){f(e)})})},conv:function(e){return new this(e)}},latitude:0,longitude:0,constructor:function(e,f){if(String.isInstance(e)){var n=e.indexOf(";");this.latitude=e.substring(0,n),this.longitude=e.substring(n+1)}else Number.isInstance(e)?(this.latitude=e,this.longitude=f):Array.isInstance(e)?(this.latitude=e[0],this.longitude=e[1]):Object.isInstance(e)&&(this.latitude=e.latitude,this.longitude=e.longitude);if(this.latitude<-90||this.latitude>90)throw new Error("Latitude "+this.latitude+" is not in bound of -90 <= latitude <= 90");if(this.longitude<-180||this.longitude>180)throw new Error("Longitude "+this.longitude+" is not in bound of -180 <= longitude <= 180")},kilometersTo:function(e){return Number((n.EARTH_RADIUS_IN_KILOMETERS*this.radiansTo(e)).toFixed(3))},milesTo:function(e){return Number((n.EARTH_RADIUS_IN_MILES*this.radiansTo(e)).toFixed(3))},radiansTo:function(e){var f=this,o=e,d=f.latitude*n.DEG_TO_RAD,i=o.latitude*n.DEG_TO_RAD,t=(o.longitude-f.longitude)*n.DEG_TO_RAD;return Math.acos(Math.sin(d)*Math.sin(i)+Math.cos(d)*Math.cos(i)*Math.cos(t))},toString:function(){return this.latitude+";"+this.longitude},toJSON:function(){return{latitude:this.latitude,longitude:this.longitude}}}));f.exports=n},{"./collection":16}],5:[function(e,f){var n=e("./message"),o=e("./util/Metadata"),d=Trait.inherit({entityManager:null,resultClass:null,ascending:function(e){return this._addOrder(e,1)},descending:function(e){return this._addOrder(e,-1)},sort:function(e){if(classOf(e)!=Object)throw new Error("sort must be an object.");return this._addOrder(e)},offset:function(e){if(0>e)throw new Error("The offset can't be nagative.");return this._addOffset(e)},limit:function(e){if(0>e)throw new Error("The limit can't be nagative.");return this._addLimit(e)},resultList:function(){},singleResult:function(){},count:function(){}});d.Condition=d.inherit({where:function(e){return this._addFilter(null,null,e)},equal:function(e,f){return this._addFilter(e,null,f)},notEqual:function(e,f){return this._addFilter(e,"$ne",f)},greaterThan:function(e,f){return this._addFilter(e,"$gt",f)},greaterThanOrEqualTo:function(e,f){return this._addFilter(e,"$gte",f)},lessThan:function(e,f){return this._addFilter(e,"$lt",f)},lessThanOrEqualTo:function(e,f){return this._addFilter(e,"$lte",f)},between:function(e,f,n){return this._addFilter(e,"$gt",f)._addFilter(e,"$lt",n)},"in":function(e,f){return this._addFilter(e,"$in",classOf(f)==Array?f:Array.prototype.slice.call(arguments,1))},notIn:function(e,f){return this._addFilter(e,"$nin",classOf(f)==Array?f:Array.prototype.slice.call(arguments,1))},isNull:function(e){return this.equal(e,null)},isNotNull:function(e){return this._addFilter(e,"$exists",!0)._addFilter(e,"$ne",null)},containsAll:function(e,f){return this._addFilter(e,"$all",classOf(f)==Array?f:Array.prototype.slice.call(arguments,1))},mod:function(e,f,n){return this._addFilter(e,"$mod",[f,n])},matches:function(e,f){if(RegExp.isInstance(f)||(f=new RegExp(f)),f.ignoreCase)throw new Error("RegExp.ignoreCase flag is not supported.");if(f.global)throw new Error("RegExp.global flag is not supported.");if(0!=f.source.indexOf("^"))throw new Error("regExp must be an anchored expression, i.e. it must be started with a ^.");var n=this._addFilter(e,"$regex",f.source);return f.multiline&&n._addFilter(e,"$options","m"),n},size:function(e,f){return this._addFilter(e,"$size",f)},near:function(e,f,n){return this._addFilter(e,"$nearSphere",{$geometry:{type:"Point",coordinates:[f.longitude,f.latitude]},$maxDistance:n})},withinPolygon:function(e,f){return f=classOf(f)==Array?f:Array.prototype.slice.call(arguments,1),this._addFilter(e,"$geoWithin",{$geometry:{type:"Polygon",coordinates:[f.map(function(e){return[e.longitude,e.latitude]})]}})}});var i=d.Condition.prototype;Object.extend(i,{lt:i.lessThan,le:i.lessThanOrEqualTo,gt:i.greaterThan,ge:i.greaterThanOrEqualTo,containsAny:i["in"]}),d.Node=Object.inherit(d,{firstResult:0,maxResults:-1,_sort:null,initialize:function(e,f){this.entityManager=e,this.resultClass=f,this._sort={}},resultList:function(e,f){var o=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!o)throw new Error("Only typed queries can be executed.");var d=this._serializeQuery(),i=this._serializeSort(),t=new n.AdhocQuery(o.name,d,this.firstResult,this.maxResults,i);return this.entityManager._send(t).then(function(){return this._createResultList(t.response.entity)}.bind(this)).then(e,f)},singleResult:function(e,f){var o=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!o)throw new Error("Only typed queries can be executed.");var d=this._serializeQuery(),i=this._serializeSort(),t=new n.AdhocQuery(o.name,d,this.firstResult,1,i);return this.entityManager._send(t).then(function(){return this._createResultList(t.response.entity)}.bind(this)).then(function(e){return e.length?e[0]:null}).then(e,f)},count:function(e,f){var o=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!o)throw new Error("Only typed queries can be executed.");var d=this._serializeQuery(),i=new n.AdhocCountQuery(o.name,d);return this.entityManager._send(i).then(function(){return i.response.entity.count}).then(e,f)},_serializeQuery:function(){return JSON.stringify(this,function(e,f){var n=this[e];return Date.isInstance(n)?{$date:f}:f})},_serializeSort:function(){return JSON.stringify(this._sort)},_createResultList:function(e){return e.length?Promise.all(e.map(function(e){var f=e._objectInfo?e._objectInfo.id:e.id;if(e._objectInfo){var n=this.entityManager.getReference(this.resultClass,f),d=o.get(n);return d.setDatabaseObject(e),d.setPersistent(),Promise.resolve(n)}return this.entityManager.load(e)},this)).then(function(e){return e.filter(function(e){return!!e})}):Promise.resolve([])},_addOrder:function(e,f){return f?this._sort[e]=f:this._sort=e,this},_addOffset:function(e){return this.firstResult=e,this},_addLimit:function(e){return this.maxResults=e,this}}),d.Builder=Object.inherit(d.Condition,{initialize:function(e,f){this.entityManager=e,this.resultClass=f},and:function(e){return this._addOperator("$and",classOf(e)==Array?e:Array.prototype.slice.call(arguments))},or:function(e){return this._addOperator("$or",classOf(e)==Array?e:Array.prototype.slice.call(arguments))},nor:function(e){return this._addOperator("$nor",classOf(e)==Array?e:Array.prototype.slice.call(arguments))},resultList:function(e,f){return this.where({}).resultList(e,f)},singleResult:function(e,f){return this.where({}).singleResult(e,f)},count:function(e,f){return this.where({}).count(e,f)},_addOperator:function(e,f){if(f.length<2)throw new Error("Only two or more queries can be joined with an "+e+" operator.");return f.forEach(function(e,f){if(!d.isInstance(e))throw new Error("Argument at index "+f+" is not a Query.")}),new d.Operator(this.entityManager,this.resultClass,e,f)},_addOrder:function(e,f){return new d.Filter(this.entityManager,this.resultClass)._addOrder(e,f)},_addFilter:function(e,f,n){return new d.Filter(this.entityManager,this.resultClass)._addFilter(e,f,n)},_addOffset:function(e){return new d.Filter(this.entityManager,this.resultClass)._addOffset(e)},_addLimit:function(e){return new d.Filter(this.entityManager,this.resultClass)._addLimit(e)}}),d.Filter=d.Node.inherit(d.Condition,{_filter:null,initialize:function(e,f){this.superCall(e,f),this._filter={}},_addFilter:function(e,f,n){if(null!==e){if(!String.isInstance(e))throw new Error("Field must be a string.");if(f){var o=this._filter[e];classOf(o)!=Object&&(this._filter[e]=o={}),o[f]=n}else this._filter[e]=n}else Object.extend(this._filter,n);return this},toJSON:function(){return this._filter}}),d.Operator=d.Node.inherit({_operator:null,_childs:null,initialize:function(e,f,n,o){this.superCall(e,f),this._operator=n,this._childs=o},toJSON:function(){var e={};return e[this._operator]=this._childs,e}}),f.exports=d},{"./message":31,"./util/Metadata":52}],6:[function(e,f){var n=Object.inherit({getValue:function(e,f){return e[f.name]},setValue:function(e,f,n){e[f.name]=n}});f.exports=n},{}],7:[function(e,f){var n=e("../util/Metadata"),o=(e("../util/Lockable"),e("./Entity")),d=e("./Managed"),i=e("./User"),t=e("./Role"),l=Object.inherit({createProxyClass:function(e){if(e.isEntity){var f=e.superType.typeConstructor;return f.inherit({constructor:function(e){e&&Object.extend(this,e)}})}if(e.isEmbeddable)return Object.inherit({constructor:function(e){e&&Object.extend(this,e)}});throw new TypeError("No proxy class can be initialized.")},getIdentifier:function(e){return e.__baqendId__},setIdentifier:function(e,f){e.__baqendId__=f},create:function(e){return Object.create(e.typeConstructor.prototype)},enhance:function(e,f){this.setIdentifier(f,e.ref),this.enhancePrototype(f,e)},enhancePrototype:function(e,f){if(this.mixinType(e,d),f.isEntity)switch(this.mixinType(e,o),f.name){case"Role":this.mixinType(e,t);break;case"User":this.mixinType(e,i)}e.prototype.toString===Object.prototype.toString&&Object.defineProperty(e.prototype,"toString",{value:function(){return this._metadata.ref||f.ref},enumerable:!1});for(var n,l=0;n=f.declaredAttributes[l];++l)this.enhanceProperty(e,n);Object.defineProperty(e.prototype,"constructor",{value:e,enumerable:!1})},mixinType:function(e,f){var n=e.linearizedTypes;n&&-1!=n.indexOf(e)||(n=e.linearizedTypes=[Object,e]);var o=e.prototypeChain;if(o||(o=e.prototypeChain=[e.prototype]),-1==n.indexOf(f)){for(var d=Object.getOwnPropertyNames(f.prototype),i=0;i<d.length;++i){var t=d[i];if("__proto__"!=t&&"constructor"!=t){var l=Object.getOwnPropertyDescriptor(f.prototype,t);l.enumerable="id"==t||"version"==t,Object.defineProperty(e.prototype,t,l)}}n.push(f),o.push(f.prototype)}},enhanceProperty:function(e,f){var o="$"+f.name;Object.defineProperty(e.prototype,f.name,{get:function(){return n.readAccess(this),this._metadata[o]},set:function(e){n.writeAccess(this),this._metadata[o]=e},configurable:!0,enumerable:!0})}});f.exports=l},{"../util/Lockable":51,"../util/Metadata":52,"./Entity":8,"./Managed":10,"./Role":12,"./User":13}],8:[function(e,f){var n=e("./Managed"),o=(e("../util/Lockable"),n.inherit({constructor:function(e,f){ManagedType.call(this,e,f)},get id(){return this._metadata.id},set id(e){if(this._metadata.id)throw new Error("Id can't be set twice.");this._metadata.id=e},get version(){return this._metadata.version},set version(e){this._metadata.version=e},get acl(){return this._metadata.acl},ready:function(e){return this._metadata.ready(e)},attach:function(e){e.attach(this)},save:function(e,f,n){return Function.isInstance(e)&&(n=f,f=e,e={}),this._metadata.db.save(this,e).then(f,n)},insert:function(e,f,n){return Function.isInstance(e)&&(n=f,f=e,e={}),this._metadata.db.insert(this,e).then(f,n)},update:function(e,f,n){return Function.isInstance(e)&&(n=f,f=e,e={}),this._metadata.db.update(this,e).then(f,n)},load:function(e,f,n){return Function.isInstance(e)&&(n=f,f=e,e={}),this._metadata.db.reload(this,e).then(f,n)},"delete":function(e,f,n){return Function.isInstance(e)&&(n=f,f=e,e={}),this._metadata.db["delete"](this,e).then(f,n)},attr:function(){throw new Error("Attr is not yet implemented.")},validate:function(){return this._metadata.db.validate(this)},toJSON:function(e){return this._metadata.getDatabaseObject(!e,!e)}}));f.exports=o},{"../util/Lockable":51,"./Managed":10}],9:[function(e,f){var n=e("./ManagedFactory"),o=e("../util/Metadata"),d=n.inherit({extend:{create:function(e,f){var o=n.create(e,f);return Object.cloneOwnProperties(o,d.prototype),o}},constructor:function(e,f){n.call(this,e,f)},newInstance:function(e){var f=this._managedType.create();return o.get(f).db=this._db,this._managedType.typeConstructor.apply(f,e),f},load:function(e,f,n,o){return Function.isInstance(f)&&(o=n,n=depth,f={}),this._db.load(this._managedType.typeConstructor,e,f).then(n,o)},_getHandler:function(e){var f=this._db.code.getHandler(this._managedType.name,e);return f?function(e){return f.call(e,this._db)}.bind(this):null},get onInsert(){return this._getHandler("insert")},get onDelete(){return this._getHandler("delete")},get onUpdate(){return this._getHandler("update")},get onValidate(){return this._managedType.validationCode},fromJSON:function(e){var f=e._objectInfo?this._db.getReference(this._managedType.typeConstructor,e._objectInfo.id):this.newInstance(),n=o.get(f);return n.setDatabaseObject(e),n.setDirty(),f},find:function(){return this._db.createQueryBuilder(this._managedType.typeConstructor)},partialUpdate:function(){throw new Error("partialUpdate is not yet implemented.")}});f.exports=d},{"../util/Metadata":52,"./ManagedFactory":11}],10:[function(e,f){var n=e("../util/Metadata"),o=Trait.inherit({_metadata:{get:function(){return this.__metadata||(this._metadata=new n(this))},set:function(e){if(this.__metadata)throw new Error("Metadata has already been set.");Object.defineProperty(this,"__metadata",{value:e,writable:!1})}}});f.exports=o},{"../util/Metadata":52}],11:[function(e,f){var n=Object.inherit({extend:{create:function(e,f){var o=function(){return o.newInstance(arguments)};return Object.cloneOwnProperties(o,n.prototype),o.constructor(e,f),o}},isInstance:function(e){return this._managedType.typeConstructor.isInstance(e)},asInstance:function(e){return this._managedType.typeConstructor.asInstance(e)},methods:null,_managedType:null,_db:null,constructor:function(e,f){this.methods=e.typeConstructor.prototype,this._managedType=e,this._db=f},newInstance:function(e){var f=this._managedType.create();return this._managedType.typeConstructor.apply(f,e),f},addMethods:function(e){Object.extend(this.methods,e)},addMethod:function(e,f){this.methods[e]=f}});f.exports=n},{}],12:[function(e,f){var n=e("./Entity"),o=e("./User"),d=e("../collection").Set,i=n.inherit({constructor:function(e,f){n.call(this,e,f)},users:null,name:null,hasUser:function(e){return this.users&&this.users.has(e)},addUser:function(e){if(!o.isInstance(e))throw new Error("Only user instances can be added to a role.");this.users||(this.users=new d),this.users.add(e)},removeUser:function(e){if(!o.isInstance(e))throw new Error("Only user instances can be removed from a role.");this.users&&this.users["delete"](e)}});f.exports=i},{"../collection":16,"./Entity":8,"./User":13}],13:[function(e,f){var n=e("./Entity"),o=n.inherit({constructor:function(e,f){n.call(this,e,f)},username:null,newPassword:function(e,f,n,o){return this._metadata.db.newPassword(this.username,e,f).then(n,o)}});f.exports=o},{"./Entity":8}],14:[function(e,f){var n=e("./EntityFactory"),o=n.inherit({extend:{create:function(e,f){var d=n.create(e,f);return Object.cloneOwnProperties(d,o.prototype),d}},constructor:function(e,f){n.call(this,e,f)},register:function(e,f,n,o){return e=String.isInstance(e)?this.fromJSON({username:e}):e,this._db.register(e,f).then(n,o)},login:function(e,f,n,o){return this._db.login(e,f).then(n,o)},logout:function(e,f){return this._db.logout().then(e,f)},newPassword:function(e,f,n,o,d){return this._db.newPassword(e,f,n).then(o,d)},get me(){return this._db.me}});f.exports=o},{"./EntityFactory":9}],15:[function(e,f,n){n.Accessor=e("./Accessor"),n.Enhancer=e("./Enhancer"),n.ManagedFactory=e("./ManagedFactory"),n.EntityFactory=e("./EntityFactory"),n.UserFactory=e("./UserFactory"),n.Managed=e("./Managed"),n.Entity=e("./Entity"),n.Role=e("./Role"),n.User=e("./User")},{"./Accessor":6,"./Enhancer":7,"./Entity":8,"./EntityFactory":9,"./Managed":10,"./ManagedFactory":11,"./Role":12,"./User":13,"./UserFactory":14}],16:[function(e,f,n){var o,d,i,t,l,u,p,s,y=e("./util/Metadata"),c="@@iterator";n.Iterator=o=Trait.inherit({extend:{DONE:{done:!0}},constructor:function(e){return e?e[c]&&Function.isInstance(e[c])?e[c]():Array.isInstance(e)?new d(e.length,function(f){return e[f]}):new i(e):void 0},next:function(){return o.DONE}}),n.IndexIterator=d=Object.inherit(o,{length:0,index:0,constructor:function(e,f){this.length=e,f&&(this.accessor=f)},accessor:function(e){return e},next:function(){if(this.index<this.length){var e={done:!1,value:this.accessor(this.index)};return this.index++,e}return o.DONE}}),n.PropertyIterator=i=o.inherit({index:0,constructor:function(e){this.object=e,this.names=Object.getOwnPropertyNames(e)},next:function(){if(this.names.length<this.index){var e=this.names[this.index++];return{done:!1,value:[e,this.object[e]]}}return o.DONE}}),n.Iterable=t=Trait.inherit({entries:function(){return null},forEach:function(e,f){if(!e||!Function.isInstance(e))throw new TypeError(e+" is not a function");for(var n,o=this.entries();!(n=o.next()).done;)e.call(f,n.value[1],n.value[0],this)},every:function(e,f){if(!e||!Function.isInstance(e))throw new TypeError(e+" is not a function");for(var n,o=this.entries();!(n=o.next()).done;)if(!e.call(f,n.value[1],n.value[0],this))return!1;return!0},some:function(e,f){if(!Function.isInstance(e))throw new TypeError(e+" is not a function");for(var n,o=this.entries();!(n=o.next()).done;)if(e.call(f,n.value[1],n.value[0],this))return!0;return!1},filter:function(e,f){if(!Function.isInstance(e))throw new TypeError(e+" is not a function");for(var n,o=new this.constructor,d=this.entries();!(n=d.next()).done;)e.call(f,n.value[1],n.value[0],this)&&(o.set?o.set(n.index,n.value):o.add(n.value));return o},map:function(e,f){if(!Function.isInstance(e))throw new TypeError(e+" is not a function");for(var n,o=new this.constructor,d=this.entries();!(n=d.next()).done;)n=e.call(f,n.value[1],n.value[0],this),o.set?o.set(n.index,n.value):o.add(n.value);return o},reduce:function(e,f){if(!Function.isInstance(e))throw new TypeError(e+" is not a function");var n=this.entries();1==arguments.length&&(f=n.next().value);for(var o;!(o=n.next()).done;)f=e.call(null,f,o.value[1],o.value[0],this);return f}}),n.Collection=l=Object.inherit(t,{array:null,get size(){return this.array.length},constructor:function(e){this.array=[];var f=o(e);if(f)for(var n;!(n=f.next()).done;)this.add(n.value)},has:function(e){return-1!=this.array.indexOf(e)},clear:function(){this.array=[]},add:function(e){y.writeAccess(this),this.array.push(e)},"delete":function(e){y.writeAccess(this);var f=this.array.indexOf(e);f>-1&&this.array.splice(f,1)},entries:function(){var e=this.array;return new d(this.size,function(f){return[f,e[f]]})},keys:function(){return new d(this.size)},values:function(){var e=this.array;return new d(this.size,function(f){return e[f]})},toString:function(){return this.array.toString()},toJSON:function(){return this.array}});var a=Array.prototype;n.List=u=l.inherit({constructor:function(e){l.call(this,e)},get:function(e){return 0>e&&(e=this.size+e),e>=0&&e<this.size?this.array[e]:void 0},add:function(e){y.writeAccess(this),this.array.push(e)},set:function(e,f){y.writeAccess(this),0>e&&(e=this.size+e),0>e?this.array.unshift(f):e>=this.size?this.array.push(f):this.array[e]=f},concat:function(){var e=a.map.call(arguments,function(e){return u.isInstance(e)?e.array:e});return new u(a.concat.apply(this.array,e))},indexOf:function(e){return this.seq.indexOf(e)},lastIndexOf:function(e){return this.seq.lastIndexOf(e)
},join:function(e){return this.array.join(e)},pop:function(){return y.writeAccess(this),this.array.pop()},push:function(){return y.writeAccess(this),a.push.apply(this.array,arguments)},reverse:function(){y.writeAccess(this),this.array.reverse()},shift:function(){return y.writeAccess(this),this.array.shift()},slice:function(e,f){return new u(this.array.slice(e,f))},sort:function(e){y.writeAccess(this),this.array.sort(e)},splice:function(){return y.writeAccess(this),a.splice.apply(this.array,arguments)},unshift:function(){return y.writeAccess(this),a.unshift.apply(this.array,arguments)}}),u.prototype[c]=u.prototype.values,n.Set=p=l.inherit({constructor:function(e){l.call(this,e)},add:function(e){var f=this.array.indexOf(e);0>f&&this.array.push(e)},entries:function(){var e=this.array;return new d(this.size,function(f){return[e[f],e[f]]})}}),p.prototype.keys=p.prototype.values,p.prototype[c]=p.prototype.values,n.Map=s=l.inherit({constructor:function(e){this.array=[],this.vals=[];var f=o(e);if(f)for(var n;!(n=f.next()).done;){if(!Array.isInstance(n.value)||2!=n.value.length)throw new Error("No key value pair in entry "+n.value);this.set(n.value[0],n.value[1])}},clear:function(){this.array=[],this.vals=[]},get:function(e){var f=this.array.indexOf(e);return f>-1?this.vals[f]:void 0},add:function(e){y.writeAccess(this),this.set(e,e)},set:function(e,f){y.writeAccess(this);var n=this.array.indexOf(e);-1==n&&(n=this.array.length,this.array[n]=e),this.vals[n]=f},remove:function(e){y.writeAccess(this);var f=this.array.indexOf(e);f>-1&&(this.array.splice(f,1),this.vals.splice(f,1))},entries:function(){var e=this.array,f=this.vals;return new d(this.size,function(n){return[e[n],f[n]]})},keys:function(){var e=this.array;return new d(this.size,function(f){return e[f]})},values:function(){var e=this.vals;return new d(this.size,function(f){return e[f]})},toString:function(){for(var e="",f=0,n=this.size;n>f;++f)""!=e&&(e+=", "),e+=this.array[f],e+=": ",e+=this.vals[f];return"["+e+"]"},toJSON:function(){for(var e=[],f=0,n=this.size;n>f;++f)e.push({key:this.array[f],value:this.vals[f]});return e}}),s.prototype[c]=s.prototype.entries},{"./util/Metadata":52}],17:[function(e,f){var n=e("../error/PersistentError"),o=Object.inherit({extend:{RESPONSE_HEADERS:["Orestes-Authorization-Token"],connectors:[],connections:{},create:function(e,f,n){if(e||"undefined"==typeof window||(e=window.location.hostname,f=Number(window.location.port),n="https:"==window.location.protocol),-1!=e.indexOf("/")){var o=/^(https?):\/\/([^\/:]*)(:(\d*))?\/?$/.exec(e);if(!o)throw new Error("The connection uri host "+e+" seems not to be valid");n="https"==o[1],e=o[2],f=o[4]}f||(f=n?443:80);var d="http"+(n?"s":"")+"://"+e+":"+f,i=this.connections[d];if(!i){for(var t in this.connectors){var l=this.connectors[t];if(l.isUsable&&l.isUsable(e,f,n)){i=new l(e,f,n);break}}if(!i)throw new Error("No connector is usable for the requested connection.");this.connections[d]=i}return i}},constructor:function(e,f,n){this.host=e,this.port=f,this.secure=n,this.origin=(n?"https://":"http://")+e,this.origin+=n&&443!=f||!n&&80!=f?":"+f:""},send:function(e){return new Promise(function(f,n){this.prepareRequestEntity(e),this.doSend(e.request,this.receive.bind(this,e,f,n))}.bind(this))["catch"](function(e){throw n(e)})},receive:function(e,f,o,d){e.response=d;try{e.response.statusCode=1223==e.response.statusCode?204:e.response.statusCode,this.prepareResponseEntity(e),e.doReceive(),f(e)}catch(i){i=n(i),e.response.entity=null,o(i)}},doSend:function(){},prepareRequestEntity:function(e){e.request.entity&&(e.request.headers["Content-Type"]="application/json;charset=utf-8",e.request.entity=JSON.stringify(e.request.entity))},prepareResponseEntity:function(e){var f=e.response.entity;f=f&&f.length>0?JSON.parse(f):null,e.response.entity=f}});f.exports=o},{"../error/PersistentError":27}],18:[function(e,f){var n=e("./Connector"),o=n.inherit({extend:{loadedAttr:"data-loaded",style:"width:1px;height:1px;position:absolute;top:-10px;left:-10px;",initialize:function(){n.connectors.push(this)},isUsable:function(e,f){return"undefined"!=typeof window&&(window.location.hostname!=e||window.location.port!=f)}},queue:null,origin:null,iframe:null,messages:null,mid:0,constructor:function d(e,f,o){n.call(this,e,f,o),this.messages={};var i=this.origin+"/connect";this.iframe=document.querySelector('iframe[src="'+i+'"]'),this.iframe&&this.iframe.src==i||(this.iframe=document.createElement("iframe"),this.iframe.src=i,this.iframe.setAttribute("style",d.style),document.body.appendChild(this.iframe)),this.isLoaded()||(this.queue=[],this.iframe.addEventListener("load",this.onLoad.bind(this),!1)),window.addEventListener("message",this.doReceive.bind(this),!1)},onLoad:function(){for(var e=this.queue,f=0;f<e.length;++f)this.iframe.contentWindow.postMessage(e[f],this.origin);this.queue=null,this.setLoaded()},setLoaded:function(){this.iframe.setAttribute(o.loadedAttr,!0)},isLoaded:function(){return!!this.iframe.getAttribute(o.loadedAttr)},doSend:function(e,f){var o={mid:++this.mid,method:e.method,path:e.path,headers:e.headers,entity:e.entity,responseHeaders:n.RESPONSE_HEADERS};this.messages[o.mid]={request:e,receive:f},o=JSON.stringify(o),this.queue?this.queue.push(o):this.iframe.contentWindow.postMessage(o,this.origin)},doReceive:function(e){if(e.origin===this.origin&&"{"==e.data[0]){var f=JSON.parse(e.data),n=this.messages[f.mid];delete this.messages[f.mid],n.receive({statusCode:f.statusCode,headers:f.headers,entity:f.entity})}}});f.exports=o},{"./Connector":17}],19:[function(e,f){var n=e("../error/CommunicationError"),o=Object.inherit({extend:{StatusCode:{NOT_MODIFIED:304,BAD_CREDENTIALS:460,BUCKET_NOT_FOUND:461,INVALID_PERMISSION_MODIFICATION:462,INVALID_TYPE_VALUE:463,OBJECT_NOT_FOUND:404,OBJECT_OUT_OF_DATE:412,PERMISSION_DENIED:466,QUERY_DISPOSED:467,QUERY_NOT_SUPPORTED:468,SCHEMA_NOT_COMPATIBLE:469,SCHEMA_STILL_EXISTS:470,SYNTAX_ERROR:471,TRANSACTION_INACTIVE:472,TYPE_ALREADY_EXISTS:473,TYPE_STILL_REFERENCED:474},create:function(e){return o.inherit({spec:e})}},spec:null,withCredentials:!1,initialize:function(){var e=arguments,f=0;this.request={method:this.spec.method,path:this.spec.params.map(function(n){return Number.isInstance(n)?(f++,encodeURIComponent(e[n])):n}).join(""),headers:{accept:"application/json"},entity:e[f]||null},this.response={statusCode:0,headers:{},entity:null}},setIfMatch:function(e){"*"!=e&&(e='"'+e+'"'),this.request.headers["If-Match"]=e},setIfNoneMatch:function(e){"*"!=e&&(e='"'+e+'"'),this.request.headers["If-None-Match"]=e},setCacheControl:function(e){this.request.headers["Cache-Control"]=e},getAuthorizationToken:function(){return this.response.headers["Orestes-Authorization-Token"]||this.response.headers["orestes-authorization-token"]},setAuthorizationToken:function(e){this.request.headers.Authorization="BAT "+e},withAuthorizationToken:function(e){e?this.setAuthorizationToken(e):this.request.withCredentials=!0},doReceive:function(){if(-1==this.spec.status.indexOf(this.response.statusCode))throw new n(this)}});f.exports=o},{"../error/CommunicationError":23}],20:[function(e,f){var n=e("./Connector"),o=n.inherit({extend:{initialize:function(){n.connectors.push(this)},isUsable:function(f,n,o){if(!this.prototype.http)try{var d;d=e(o?"https":"http"),d.request&&d.Server&&(this.prototype.http=d)}catch(i){}return Boolean(this.prototype.http)}},constructor:function(){n.apply(this,arguments)},cookie:null,doSend:function(e,f){e.host=this.host,e.port=this.port;var n=this,o=e.entity;o&&(e.headers["Transfer-Encoding"]="chunked"),this.cookie&&this.secure&&e.withCredentials&&(e.headers.Cookie=this.cookie);var d=this.http.request(e,function(e){var o="";e.setEncoding("utf-8"),e.on("data",function(e){o+=e}),e.on("end",function(){var d=e.headers["set-cookie"];d&&(n.cookie=n.parseCookie(d+"")),f({statusCode:e.statusCode,headers:e.headers,entity:o})})});d.on("error",function(e){f({statusCode:0,error:e})}),o&&d.write(o,"utf8"),d.end()},parseCookie:function(e){for(var f,n=e.split(";"),o=0;f=n[o];++o)if(0==f.indexOf("Expires=")){var d=Date.parse(f.substring(8));if(d<Date.now())return null}return n[0]}});f.exports=o},{"./Connector":17,http:void 0,https:void 0}],21:[function(e,f){var n=e("./Connector"),o=n.inherit({extend:{initialize:function(){n.connectors.push(this)},isUsable:function(e,f,n){return"undefined"!=window&&window.location.hostname==e&&window.location.port==f&&window.location.protocol==(n?"https:":"http:")&&"undefined"!=typeof XMLHttpRequest}},constructor:function(){n.apply(this,arguments)},doSend:function(e,f){var o=new XMLHttpRequest,d=this.origin+e.path;o.onreadystatechange=function(){if(4==o.readyState){var e={headers:{},statusCode:o.status,entity:o.response||o.responseText};n.RESPONSE_HEADERS.forEach(function(f){e.headers[f]=o.getResponseHeader(f)}),f(e)}},o.open(e.method,d,!0);var i=e.entity,t=e.headers;for(var l in t)o.setRequestHeader(l,t[l]);o.withCredentials=e.withCredentials,o.send(i)}});f.exports=o},{"./Connector":17}],22:[function(e,f,n){n.Message=e("./Message"),n.Connector=e("./Connector"),n.NodeConnector=e("./NodeConnector"),n.XMLHttpConnector=e("./XMLHttpConnector"),n.IFrameConnector=e("./IFrameConnector")},{"./Connector":17,"./IFrameConnector":18,"./Message":19,"./NodeConnector":20,"./XMLHttpConnector":21}],23:[function(e,f){var n=e("./PersistentError"),o=n.inherit({statusCode:0,initialize:function(e){var f=0==e.response.statusCode?"Request":"Response";this.superCall("baqend.error.CommunicationError: Communication failed by handling the "+f+" for "+e.request.method+" "+e.request.path,e.response.entity),this.statusCode=e.response.statusCode;var n=e.response.entity;for(n&&n.data&&(this.data=n.data);n;){this.stack+="\nServerside Caused by: "+n.className+" "+n.message;for(var o=n.stackTrace,d=0;d<o.length;++d){var i=o[d];this.stack+="\n    at "+i.className+"."+i.methodName,this.stack+=" ("+i.fileName+":"+i.lineNumber+")"}n=n.cause}}});f.exports=o},{"./PersistentError":27}],24:[function(e,f){var n=e("./PersistentError"),o=n.inherit({initialize:function(e){this.superCall("baqend.error.EntityExistsError: The entity "+e+" is managed by a different db."),this.entity=e}});f.exports=o},{"./PersistentError":27}],25:[function(e,f){var n=e("./PersistentError"),o=n.inherit({initialize:function(e){this.superCall("baqend.error.EntityNotFoundError: Entity "+e+" is not found"),this.identity=e}});f.exports=o},{"./PersistentError":27}],26:[function(e,f){var n=e("./PersistentError"),o=n.inherit({initialize:function(e){this.superCall("baqend.error.IllegalEntityError: Entity "+e+" is not a valid entity"),this.entity=e}});f.exports=o},{"./PersistentError":27}],27:[function(e,f){var n=Error.inherit({cause:null,extend:{conv:function(e){return Error.isInstance(e)?new this(null,e):void 0}},initialize:function(e,f){this.superCall(e?e:f.message),f&&(this.cause=f,f.stack&&(this.stack+="\nCaused By: "+f.stack))}});f.exports=n},{}],28:[function(e,f){var n=e("./PersistentError"),o=n.inherit({initialize:function(e){this.superCall("baqend.error.RollbackError: The transaction has been rollbacked",e)}});f.exports=o},{"./PersistentError":27}],29:[function(e,f,n){n.CommunicationError=e("./CommunicationError"),n.EntityExistsError=e("./EntityExistsError"),n.EntityNotFoundError=e("./EntityNotFoundError"),n.IllegalEntityError=e("./IllegalEntityError"),n.PersistentError=e("./PersistentError"),n.RollbackError=e("./RollbackError")},{"./CommunicationError":23,"./EntityExistsError":24,"./EntityNotFoundError":25,"./IllegalEntityError":26,"./PersistentError":27,"./RollbackError":28}],30:[function(e,f,n){"use strict";e("jahcode"),e("lie/dist/lie.polyfill"),e("./polyfills");var o=e("./EntityManagerFactory"),d=(e("./EntityManager"),new o({global:!0}));n=f.exports=d.createEntityManager(!0),n.collection=e("./collection"),n.binding=e("./binding"),n.connector=e("./connector"),n.error=e("./error"),n.message=e("./message"),n.metamodel=e("./metamodel"),n.util=e("./util"),n.EntityManager=e("./EntityManager"),n.EntityManagerFactory=e("./EntityManagerFactory"),n.EntityTransaction=e("./EntityTransaction"),n.Query=e("./Query"),n.connect=function(e,f){return d.connect(e),this.ready(f)}},{"./EntityManager":1,"./EntityManagerFactory":2,"./EntityTransaction":3,"./Query":5,"./binding":15,"./collection":16,"./connector":22,"./error":29,"./message":31,"./metamodel":47,"./polyfills":48,"./util":56,jahcode:57,"lie/dist/lie.polyfill":58}],31:[function(e,f,n){var o=e("./connector/Message");n.ListAllResources=o.create({method:"GET",params:["/"],status:[200]}),n.ApiVersion=o.create({method:"GET",params:["/version"],status:[200]}),n.ListAllApis=o.create({method:"GET",params:["/spec"],status:[200]}),n.ListApiSpecification=o.create({method:"GET",params:["/spec/",0],status:[200]}),n.GetBloomFilter=o.create({method:"GET",params:["/replication"],status:[200]}),n.GetOrestesConfig=o.create({method:"GET",params:["/config"],status:[200]}),n.UpdateOrestesConfig=o.create({method:"PUT",params:["/config"],status:[202,204]}),n.Create=o.create({method:"POST",params:["/create"],status:[201]}),n.Connect=o.create({method:"GET",params:["/connect"],status:[200]}),n.GetBucketNames=o.create({method:"GET",params:["/db"],status:[200]}),n.GetBucketIds=o.create({method:"GET",params:["/db/",0,"/ids?start=",1,"&count=",2],status:[200]}),n.ExportBucket=o.create({method:"GET",params:["/db/",0],status:[200]}),n.ImportBucket=o.create({method:"PUT",params:["/db/",0],status:[200]}),n.CreateObject=o.create({method:"POST",params:["/db/",0],status:[201,202]}),n.GetObject=o.create({method:"GET",params:["/db/",0,"/",1],status:[200,304]}),n.ReplaceObject=o.create({method:"PUT",params:["/db/",0,"/",1],status:[200,202]}),n.DeleteObject=o.create({method:"DELETE",params:["/db/",0,"/",1],status:[202,204]}),n.GetAllSchemas=o.create({method:"GET",params:["/schema"],status:[200]}),n.UpdateAllSchemas=o.create({method:"POST",params:["/schema"],status:[200]}),n.ReplaceAllSchemas=o.create({method:"PUT",params:["/schema"],status:[200]}),n.DeleteAllSchemas=o.create({method:"DELETE",params:["/schema"],status:[204,304]}),n.GetSchema=o.create({method:"GET",params:["/schema/",0],status:[200]}),n.UpdateSchema=o.create({method:"POST",params:["/schema/",0],status:[200]}),n.ReplaceSchema=o.create({method:"PUT",params:["/schema/",0],status:[200]}),n.DeleteSchema=o.create({method:"DELETE",params:["/schema/",0],status:[204,304]}),n.AdhocQueryIds=o.create({method:"GET",params:["/db/",0,"/ids?query=",1,"&start=",2,"&count=",3,"&sort=",4],status:[200]}),n.AdhocQuery=o.create({method:"GET",params:["/db/",0,"?query=",1,"&start=",2,"&count=",3,"&sort=",4],status:[200]}),n.AdhocCountQuery=o.create({method:"GET",params:["/db/",0,"/count?query=",1],status:[200]}),n.ListQueryResources=o.create({method:"GET",params:["/query"],status:[200]}),n.CreateQuery=o.create({method:"POST",params:["/query"],status:[201]}),n.ListThisQueryResources=o.create({method:"GET",params:["/query/",0],status:[200]}),n.GetQueryCode=o.create({method:"GET",params:["/query/",0,"/source"],status:[200]}),n.RunQuery=o.create({method:"GET",params:["/query/",0,"/result;start=",1,";count=",2],status:[200]}),n.GetQueryParameters=o.create({method:"GET",params:["/query/",0,"/parameters"],status:[200]}),n.GetActiveTransactions=o.create({method:"GET",params:["/transaction"],status:[200]}),n.NewTransaction=o.create({method:"POST",params:["/transaction"],status:[201]}),n.ListTransactionalSubresurces=o.create({method:"GET",params:["/transaction/",0],status:[200]}),n.AbortTransaction=o.create({method:"PUT",params:["/transaction/",0,"/aborted"],status:[204]}),n.GetTransactionChangeset=o.create({method:"GET",params:["/transaction/",0,"/changeset"],status:[200]}),n.CommitTransaction=o.create({method:"PUT",params:["/transaction/",0,"/committed"],status:[200]}),n.ListTransactionResources=o.create({method:"GET",params:["/transaction/",0,"/dbview"],status:[200]}),n.ListTransactionBucketResources=o.create({method:"GET",params:["/transaction/",0,"/dbview/",1],status:[200]}),n.GetTransactionStateObject=o.create({method:"GET",params:["/transaction/",0,"/dbview/",1,"/",2],status:[200]}),n.QueryTransactional=o.create({method:"GET",params:["/transaction/",0,"/dbview/",1,"?query=",2,"&start=",3,"&count=",4],status:[200]}),n.RunQueryTransactional=o.create({method:"GET",params:["/transaction/",0,"/queryview/",1,"/result;start=",2,";count=",3],status:[200]}),n.UpdatePartially=o.create({method:"POST",params:["/db/",0,"/",1],status:[204]}),n.UpdateField=o.create({method:"POST",params:["/db/",0,"/",1,"/",2],status:[204]}),n.Login=o.create({method:"POST",params:["/db/User/login"],status:[200]}),n.Register=o.create({method:"POST",params:["/db/User/register"],status:[200]}),n.Me=o.create({method:"GET",params:["/db/User/me"],status:[200]}),n.ValidateUser=o.create({method:"GET",params:["/db/User/validate"],status:[200]}),n.Logout=o.create({method:"GET",params:["/db/User/logout"],status:[204]}),n.NewPassword=o.create({method:"POST",params:["/db/User/password"],status:[200]}),n.GetBaqendHandler=o.create({method:"GET",params:["/code/",0,"/",1],status:[200]}),n.SetBaqendHandler=o.create({method:"PUT",params:["/code/",0,"/",1],status:[200]}),n.DeleteBaqendHandler=o.create({method:"DELETE",params:["/code/",0,"/",1],status:[204]}),n.SetBaqendCode=o.create({method:"PUT",params:["/code/",0],status:[200]}),n.GetBaqendCode=o.create({method:"GET",params:["/code/",0],status:[200]}),n.DeleteBaqendCode=o.create({method:"DELETE",params:["/code/",0],status:[204]}),n.CallBaqendCode=o.create({method:"POST",params:["/code/",0],status:[200,204]}),n.GetAllCodeResources=o.create({method:"GET",params:["/code"],status:[200]}),n.GetFile=o.create({method:"GET",params:["/file/",0,"/",1],status:[200,304]}),n.ReplaceFile=o.create({method:"PUT",params:["/file/",0,"/",1],status:[203]}),n.DeleteFile=o.create({method:"DELETE",params:["/file/",0,"/",1],status:[203]}),n.ListIndexes=o.create({method:"GET",params:["/index/",0],status:[200]}),n.CreateDropIndex=o.create({method:"POST",params:["/index/",0],status:[202]}),n.DropAllIndexes=o.create({method:"DELETE",params:["/index/",0],status:[202]})},{"./connector/Message":19}],32:[function(e,f){var n=e("../binding/Accessor"),o=Object.inherit({extend:{PersistentAttributeType:{BASIC:0,ELEMENT_COLLECTION:1,EMBEDDED:2,MANY_TO_MANY:3,MANY_TO_ONE:4,ONE_TO_MANY:5,ONE_TO_ONE:6}},get isAssociation(){return this.persistentAttributeType>o.PersistentAttributeType.EMBEDDED},get isCollection(){return this.persistentAttributeType==o.PersistentAttributeType.ELEMENT_COLLECTION},isId:!1,isVersion:!1,accessor:null,persistentAttributeType:-1,declaringType:null,name:null,order:null,constructor:function(e){this.name=e},init:function(e,f){if(this.declaringType)throw new Error("The attribute is already initialized.");this.order=f,this.accessor=new n,this.declaringType=e},getValue:function(e){return this.accessor.getValue(e,this)},setValue:function(e,f){this.accessor.setValue(e,this,f)},toJSON:function(){}});f.exports=o},{"../binding/Accessor":6}],33:[function(e,f){var n=e("./Type"),o=e("../GeoPoint"),d=n.inherit({persistenceType:n.PersistenceType.BASIC,noResolving:!1,constructor:function(e,f,o){0!=e.indexOf("/db/")&&(e="/db/"+e),n.call(this,e,f),this.noResolving=o},toDatabaseValue:function(e,f){return null===f||void 0===f?null:this.typeConstructor.asInstance(f)},fromDatabaseValue:function(e,f){return null===f||void 0===f?null:this.typeConstructor.asInstance(f)},toString:function(){return"BasicType("+this.ref+")"}});d.extend({Boolean:new d("Boolean",Boolean),Double:new d("Double",Number),Integer:new d("Integer",Number),String:new d("String",String),DateTime:new(d.inherit({initialize:function(){d.call(this,"DateTime",Date)},toDatabaseValue:function(e,f){var n=this.superCall(e,f);return n&&(n=n.toISOString()),n}})),Date:new(d.inherit({initialize:function(){d.call(this,"Date",Date)},toDatabaseValue:function(e,f){var n=this.superCall(e,f);return n&&(n=n.toISOString(),n=n.substring(0,n.indexOf("T"))),n}})),Time:new(d.inherit({initialize:function(){d.call(this,"Time",Date)},toDatabaseValue:function(e,f){var n=this.superCall(e,f);return n&&(n=n.toISOString(),n=n.substring(n.indexOf("T")+1)),n},fromDatabaseValue:function(e,f){return this.superCall(e,f?"1970-01-01T"+f:f)}})),GeoPoint:new d("GeoPoint",o),JsonArray:new(d.inherit({initialize:function(){d.call(this,"JsonArray",Array)},init:function(e){this._enhancer=e},toDatabaseValue:function(e,f){return f&&f.constructor==Array?f:null}})),JsonObject:new(d.inherit({initialize:function(){d.call(this,"JsonObject",Object)},init:function(e){this._enhancer=e},toDatabaseValue:function(e,f){return f&&f.constructor==Object?f:null}}))}),f.exports=d},{"../GeoPoint":4,"./Type":46}],34:[function(e,f){var n=e("./PluralAttribute"),o=e("../collection"),d=n.inherit({collectionType:n.CollectionType.COLLECTION,constructor:function(e,f){n.call(this,e,f),this.typeConstructor=o.Collection}});f.exports=d},{"../collection":16,"./PluralAttribute":43}],35:[function(e,f){var n=Object.inherit({extend:{ASC:"asc",DESC:"desc",GEO:"geo",fromJSON:function(e){return new n(e.keys,e.unique)}},drop:!1,constructor:function o(e,f){if(String.isInstance(e)){var n={};n[e]=o.ASC,this.keys=[n]}else if(Array.isInstance(e))this.keys=e;else{if(!Object.isInstance(e))throw new Error("The keys parameter must be an String, Object or Array.");this.keys=[e]}this.unique=f===!0},hasKey:function(e){for(var f=0;f<this.keys.length;f++)if(this.keys[f][e])return!0;return!1},get isCompound(){return this.keys.length>1},get isUnique(){return this.unique},toJSON:function(){return{unique:this.unique,keys:this.keys,drop:this.drop}}});f.exports=n},{}],36:[function(e,f){var n=e("./ManagedType"),o=e("./Type"),d=e("../binding/ManagedFactory"),i=n.inherit({persistenceType:o.PersistenceType.EMBEDDABLE,constructor:function(e,f){n.call(this,e,f)},createObjectFactory:function(e){return d.create(this,e)},toDatabaseValue:function(e,f){return this.typeConstructor.isInstance(f)&&!f.hasOwnProperty("__metadata")&&(f._metadata={_root:e._root}),this.superCall(e,f)},fromDatabaseValue:function(e,f,n){return!n&&f&&(n=this.create(),n._metadata._root=e._root),this.superCall(e,f,n)},toString:function(){return"EmbeddableType("+this.ref+")"}});f.exports=i},{"../binding/ManagedFactory":11,"./ManagedType":39,"./Type":46}],37:[function(e,f){var n=e("../binding"),o=e("./SingularAttribute"),d=e("./BasicType"),i=e("./Type"),t=e("./ManagedType"),l=e("../util/Metadata"),u=e("../util/Permission"),p=t.inherit({persistenceType:i.PersistenceType.ENTITY,declaredId:null,declaredVersion:null,superType:null,get id(){return this.declaredId||this.superType.id},get version(){return this.declaredVersion||this.superType.version},updatePermission:null,insertPermission:null,deletePermission:null,queryPermission:null,schemaSubclassPermission:null,constructor:function(e,f,n){t.call(this,e,n),this.superType=f,this.insertPermission=new u,this.updatePermission=new u,this.deletePermission=new u,this.queryPermission=new u,this.schemaSubclassPermission=new u},createObjectFactory:function(e){switch(this.name){case"User":return n.UserFactory.create(this,e);case"Object":return void 0}return n.EntityFactory.create(this,e)},fromDatabaseValue:function(e,f,n){return e._root==n?this.superCall(e,f,n):f?e.db.getReference(f):null},toDatabaseValue:function(e,f){return e._root==f?this.superCall(e,f):this.typeConstructor.isInstance(f)?(f.attach(e.db),l.get(f).ref):null},toString:function(){return"EntityType("+this.ref+")"},toJSON:function(){var e=this.superCall();return e.acl.schemaSubclass=this.schemaSubclassPermission,e.acl.insert=this.insertPermission,e.acl.update=this.updatePermission,e.acl["delete"]=this.deletePermission,e.acl.query=this.queryPermission,e}});p.extend({Object:p.inherit({extend:{ref:"/db/Object"},constructor:function(){p.call(this,p.Object.ref,null,Object),this.declaredId=new o("id",d.String),this.declaredId.init(this),this.declaredId.isId=!0,this.declaredVersion=new o("version",d.Double),this.declaredVersion.init(this),this.declaredVersion.isVersion=!0}})}),f.exports=p},{"../binding":15,"../util/Metadata":52,"../util/Permission":53,"./BasicType":33,"./ManagedType":39,"./SingularAttribute":45,"./Type":46}],38:[function(e,f){var n=e("./PluralAttribute"),o=e("../collection"),d=n.inherit({extend:{ref:"/db/collection.List"},collectionType:n.CollectionType.LIST,constructor:function(e,f){n.call(this,e,f),this.typeConstructor=o.List},toJSON:function(){return{name:this.name,type:d.ref+"["+this.elementType.ref+"]",order:this.order}}});f.exports=d},{"../collection":16,"./PluralAttribute":43}],39:[function(e,f){var n=e("./Type"),o=e("../util/Permission"),d=e("../collection").Iterator,i=n.inherit({AttributeIterator:Object.inherit(d,{index:0,constructor:function(e){this.types=[];do this.types.push(e);while(e=e.superType)},next:function(){for(var e=this.types.pop();e&&e.declaredAttributes.length==this.index;)e=this.types.pop(),this.index=0;return e?(this.types.push(e),{done:!1,value:e.declaredAttributes[this.index++]}):d.DONE}}),_enhancer:null,declaredAttributes:null,superType:null,loadPermission:null,schemaAddPermission:null,schemaReplacePermission:null,set validationCode(e){if(e){if(String.isInstance(e)){for(var f,n=[],o=this.attributes();!(f=o.next()).done;)n.push(f.value.name);e=new Function(n,e)}}else e=null;this._validationCode=e},get validationCode(){return this._validationCode},_validationCode:null,get typeConstructor(){return this._typeConstructor||(this.typeConstructor=this._enhancer.createProxyClass(this)),this._typeConstructor},set typeConstructor(e){if(this._typeConstructor)throw new Error("typeConstructor has already been set.");this._typeConstructor=e,this._enhancer.enhance(this,this._typeConstructor)},constructor:function(e,f){n.call(this,0!=e.indexOf("/db/")?"/db/"+e:e,f),this.declaredAttributes=[],this.loadPermission=new o,this.schemaAddPermission=new o,this.schemaReplacePermission=new o},init:function(e){this._enhancer=e,this._typeConstructor&&!this._enhancer.getIdentifier(this._typeConstructor)&&this._enhancer.setIdentifier(this._typeConstructor,this.ref)},createObjectFactory:function(){},create:function(){return this._enhancer.create(this)},attributes:function(){return new this.AttributeIterator(this)},addAttribute:function(e,f){if(this.getAttribute(e.name))throw new Error("An attribute with the name "+e.name+" is already declared.");f=null==e.order?"undefined"==typeof f?this.declaredAttributes.length:f:e.order,e.init(this,f),this.declaredAttributes.push(e),this._typeConstructor&&this._enhancer.enhanceProperty(this._typeConstructor,e)},removeAttribute:function(e){var f=this.declaredAttributes.length;if(this.declaredAttributes=this.declaredAttributes.filter(function(f){return f.name!=e}),f==this.declaredAttributes.length)throw new Error("An Attribute with the name "+e+" is not declared.")},getAttribute:function(e){var f=this.getDeclaredAttribute(e);return!f&&this.superType&&(f=this.superType.getAttribute(e)),f},getDeclaredAttribute:function(e){for(var f,n=0;f=this.declaredAttributes[n];++n)if(f.name==e)return f;return null},fromDatabaseValue:function(e,f,n){if(f)for(var o,d=this.attributes();!(o=d.next()).done;){var i=o.value;i.setDatabaseValue(e,n,f[i.name])}else n=null;return n},toDatabaseValue:function(e,f){var n=null;if(this.typeConstructor.isInstance(f)){n={};for(var o,d=this.attributes();!(o=d.next()).done;){var i=o.value;n[i.name]=i.getDatabaseValue(e,f)}}return n},toJSON:function(){var e={};e["class"]=this.ref,this.superType&&(e.superClass=this.superType.ref),this.isEmbeddable&&(e.embedded=!0),e.acl={load:this.loadPermission,schemaAdd:this.schemaAddPermission,schemaReplace:this.schemaReplacePermission};for(var f,n=e.fields={},o=0;f=this.declaredAttributes[o];o++)n[f.name]=f;return e},references:function(){return new this.ReferenceIterator(this)},ReferenceIterator:Object.inherit({constructor:function(e){this.type=e,this.attributes=this.type.attributes(),this.embedded=[]},next:function(){for(var e,f=this.attributes;!(e=f.next()).done;){var n=e.value,o=n.isCollection?n.elementType:n.type;if(o.isEntity)return{done:!1,value:{path:[n.name]}};if(o.isEmbeddable)for(var d,i=o.references();!(d=i.next()).done;)this.embedded.push({done:!1,value:{path:[n.name].concat(d.value.path)}})}return this.embedded.length?this.embedded.pop():{done:!0}}})});f.exports=i},{"../collection":16,"../util/Permission":53,"./Type":46}],40:[function(e,f){var n=e("./PluralAttribute"),o=e("../collection"),d=e("../error/PersistentError"),i=n.inherit({extend:{ref:"/db/collection.Map"},collectionType:n.CollectionType.MAP,keyType:null,constructor:function(e,f,d){n.call(this,e,d),this.keyType=f,this.typeConstructor=o.Map},getDatabaseValue:function(e,f){var n=this.getValue(f);if(n){n._metadata||Object.defineProperty(n,"_metadata",{value:{_root:e._root}});for(var o,i={},t=n.entries();!(o=t.next()).done;){if(null===o.value[0]||void 0===o.value[1])throw new d("Map keys can't be null nor undefined.");i[this.keyType.toDatabaseValue(e,o.value[0])]=this.elementType.toDatabaseValue(e,o.value[1])}return i}return null},setDatabaseValue:function(e,f,n){var o=null;if(n){o=this.getValue(f),this.typeConstructor.isInstance(o)||(o=new this.typeConstructor,Object.defineProperty(o,"_metadata",{value:{_root:e._root}}));var d=o.array,i=o.vals;o.array=[],o.vals=[];for(var t in n){t=this.keyType.fromDatabaseValue(e,t);var l=d.indexOf(t),u=this.elementType.fromDatabaseValue(e,n[t],-1!=l?i[l]:null);o.set(t,u)}}this.setValue(f,o)},toJSON:function(){return{name:this.name,type:i.ref+"["+this.keyType.ref+","+this.elementType.ref+"]",order:this.order}}});f.exports=i},{"../collection":16,"../error/PersistentError":27,"./PluralAttribute":43}],41:[function(e,f){var n=(e("./BasicType"),e("./ManagedType")),o=e("./EntityType"),d=e("../binding/Enhancer"),i=e("./ModelBuilder"),t=e("./DbIndex"),l=e("../util/Lockable"),u=e("../connector/Message").StatusCode,p=e("../message"),s=Object.inherit(l,{isInitialized:!1,_connector:null,entities:null,embeddables:null,baseTypes:null,constructor:function(){this._enhancer=new d,this.lock()},connected:function(e){this._connector=e,this.unlock()},init:function(e){if(e){if(this.isInitialized)throw new Error("Metamodel is already initialized.");this.fromJSON(e||[]),this.isInitialized=!0}else this.isInitialized||this.load();return this.ready()},_getRef:function(e){var f;return String.isInstance(e)?(f=e,0!=f.indexOf("/db/")&&(f="/db/"+e)):f=this._enhancer.getIdentifier(e),f},entity:function(e){var f=this._getRef(e);return f?this.entities[f]:null},baseType:function(e){var f=null;if(String.isInstance(e))f=this._getRef(e);else for(var n in this.baseTypes){var o=this.baseTypes[n];if(!o.noResolving&&o.typeConstructor==e){f=n;break}}return f?this.baseTypes[f]:null},embeddable:function(e){var f=this._getRef(e);return f?this.embeddables[f]:null},managedType:function(e){return this.baseType(e)||this.entity(e)||this.embeddable(e)},addType:function(e){var f;if(e.isBasic?f=this.baseTypes:e.isEmbeddable?(e.init(this._enhancer),f=this.embeddables):e.isEntity&&(e.init(this._enhancer),f=this.entities,null==e.superType&&e.ref!=o.Object.ref&&(e.superType=this.entity(o.Object.ref))),f[e.ref])throw new Error("The type "+e.ref+" is already declared.");return f[e.ref]=e},load:function(){if(this.isInitialized)throw new Error("Metamodel is already initialized.");return this.withLock(function(){this.isInitialized=!0;var e=new p.GetAllSchemas;return this._connector.send(e).then(function(e){return this.fromJSON(e.response.entity),this}.bind(this))}.bind(this))},save:function(e,f,o){if(n.isInstance(e)||(o=f,f=e,e=null),!this.isInitialized)throw new Error("Metamodel is not initialized.");return this.withLock(function(){var n;return n=e?f?new p.ReplaceSchema(e.name,e.toJSON()):new p.UpdateSchema(e.name,e.toJSON()):f?new p.ReplaceAllSchemas(this.toJSON()):new p.UpdateAllSchemas(this.toJSON()),n.withAuthorizationToken(o),this._connector.send(n).then(function(){return this}.bind(this))}.bind(this))},toJSON:function(){var e=[];for(var f in this.entities)e.push(this.entities[f]);
for(f in this.embeddables)e.push(this.embeddables[f]);return e},fromJSON:function(e){var f=new i,n=f.buildModels(e);this.baseTypes={},this.embeddables={},this.entities={};for(var o in n){var d=n[o];this.addType(d)}},createIndex:function(e,f,n){f.drop=!1;var o=new p.CreateDropIndex(e,f.toJSON());return o.withAuthorizationToken(n),this._connector.send(o)},dropIndex:function(e,f,n){f.drop=!0;var o=new p.CreateDropIndex(e,f.toJSON());return o.withAuthorizationToken(n),this._connector.send(o)},dropAllIndexes:function(e,f){var n=new p.DropAllIndexes(e);return n.withAuthorizationToken(f),this._connector.send(n)},getIndexes:function(e,f){var n=new p.ListIndexes(e);return n.withAuthorizationToken(f),this._connector.send(n).then(function(e){return e.response.entity.map(function(e){return new t(e.keys,e.unique)})},function(e){if(e.statusCode==u.BUCKET_NOT_FOUND)return null;throw e})}});f.exports=s},{"../binding/Enhancer":7,"../connector/Message":19,"../message":31,"../util/Lockable":51,"./BasicType":33,"./DbIndex":35,"./EntityType":37,"./ManagedType":39,"./ModelBuilder":42}],42:[function(e,f){var n=e("./BasicType"),o=e("./EntityType"),d=e("./EmbeddableType"),i=e("./ListAttribute"),t=e("./MapAttribute"),l=e("./SetAttribute"),u=e("./SingularAttribute"),p=e("../error/PersistentError"),s=Object.inherit({models:null,modelDescriptors:null,constructor:function(){this.models={};for(var e in n)if(n.hasOwnProperty(e)){var f=n[e];f instanceof n&&(this.models[f.ref]=f)}},getModel:function(e){return e in this.models?this.models[e]:this.models[e]=this.buildModel(e)},buildModels:function(e){this.modelDescriptors={};for(var f,n=0;f=e[n];++n)this.modelDescriptors[f["class"]]=f;for(var d in this.modelDescriptors)try{var i=this.getModel(d);this.buildAttributes(i)}catch(t){throw new p("Can't create model for entity class "+d,t)}return this.getModel(o.Object.ref),this.models},buildModel:function(e){if(e==o.Object.ref)return new o.Object;if(!(e in this.modelDescriptors))throw new TypeError("No model available for "+e);var f=this.modelDescriptors[e];if(f){var n;if(f.embedded)n=new d(e);else{var i=f.superClass||o.Object.ref;n=new o(e,this.getModel(i))}var t=f.acl;for(var l in t)n[l+"Permission"].fromJSON(t[l]);return n}},buildAttributes:function(e){var f=this.modelDescriptors[e.ref],n=f.fields,o=[];for(var d in n){o.push(d);var i=n[d];e.addAttribute(this.buildAttribute(i.name,i.type),i.order)}f.validationCode&&(e.validationCode=new Function(o,f.validationCode))},buildAttribute:function(e,f){if(0!=f.indexOf("/db/collection."))return new u(e,this.getModel(f));var n=f.substring(0,f.indexOf("[")),o=f.substring(f.indexOf("[")+1,f.indexOf("]")).trim();switch(n){case i.ref:return new i(e,this.getModel(o));case l.ref:return new l(e,this.getModel(o));case t.ref:var d=o.substring(0,o.indexOf(",")).trim();return o=o.substring(o.indexOf(",")+1).trim(),new t(e,this.getModel(d),this.getModel(o));default:throw new TypeError("No collection available for "+f)}}});f.exports=s},{"../error/PersistentError":27,"./BasicType":33,"./EmbeddableType":36,"./EntityType":37,"./ListAttribute":38,"./MapAttribute":40,"./SetAttribute":44,"./SingularAttribute":45}],43:[function(e,f){var n=e("./Attribute"),o=n.inherit({extend:{CollectionType:{COLLECTION:0,LIST:1,MAP:2,SET:3}},typeConstructor:null,persistentAttributeType:n.PersistentAttributeType.ELEMENT_COLLECTION,elementType:null,constructor:function(e,f){n.call(this,e),this.elementType=f},getDatabaseValue:function(e,f){var n=this.getValue(f);if(this.typeConstructor.isInstance(n)){n._metadata||Object.defineProperty(n,"_metadata",{value:{_root:e._root}});for(var o,d=[],i=n.values();!(o=i.next()).done;)d.push(this.elementType.toDatabaseValue(e,o.value));return d}return null},setDatabaseValue:function(e,f,n){var o=null;if(n){o=this.getValue(f),this.typeConstructor.isInstance(o)||(o=new this.typeConstructor,Object.defineProperty(o,"_metadata",{value:{_root:e._root}}));var d=o.array;o.array=[];for(var i=0,t=n.length;t>i;++i)o.add(this.elementType.fromDatabaseValue(e,n[i],d[i]))}this.setValue(f,o)}});f.exports=o},{"./Attribute":32}],44:[function(e,f){var n,o=e("./PluralAttribute"),d=e("../collection"),n=o.inherit({extend:{ref:"/db/collection.Set"},collectionType:o.CollectionType.SET,constructor:function(e,f){o.call(this,e,f),this.typeConstructor=d.Set},toJSON:function(){return{name:this.name,type:n.ref+"["+this.elementType.ref+"]",order:this.order}}});f.exports=n},{"../collection":16,"./PluralAttribute":43}],45:[function(e,f){var n=e("./Attribute"),o=e("./Type"),d=n.inherit({get typeConstructor(){return this.type.typeConstructor},type:null,constructor:function(e,f){switch(n.call(this,e),this.type=f,f.persistenceType){case o.PersistenceType.BASIC:this.persistentAttributeType=n.PersistentAttributeType.BASIC;break;case o.PersistenceType.EMBEDDABLE:this.persistentAttributeType=n.PersistentAttributeType.EMBEDDED;break;case o.PersistenceType.ENTITY:this.persistentAttributeType=n.PersistentAttributeType.ONE_TO_MANY}},getDatabaseValue:function(e,f){return this.type.toDatabaseValue(e,this.getValue(f))},setDatabaseValue:function(e,f,n){this.setValue(f,this.type.fromDatabaseValue(e,n,this.getValue(f)))},toJSON:function(){return{name:this.name,type:this.type.ref,order:this.order}}});f.exports=d},{"./Attribute":32,"./Type":46}],46:[function(e,f){var n=Object.inherit({extend:{PersistenceType:{BASIC:0,EMBEDDABLE:1,ENTITY:2,MAPPED_SUPERCLASS:3}},get isBasic(){return this.persistenceType==n.PersistenceType.BASIC},get isEmbeddable(){return this.persistenceType==n.PersistenceType.EMBEDDABLE},get isEntity(){return this.persistenceType==n.PersistenceType.ENTITY},get isMappedSuperclass(){return this.persistenceType==n.PersistenceType.MAPPED_SUPERCLASS},persistenceType:-1,get typeConstructor(){return this._typeConstructor},set typeConstructor(e){if(this._typeConstructor)throw new Error("typeConstructor has already been set.");this._typeConstructor=e},ref:null,name:null,constructor:function(e,f){if(0!=e.indexOf("/db/"))throw new SyntaxError("Type ref "+e+" is invalid.");this.ref=e,this.name=e.substring(4),this._typeConstructor=f},fromDatabaseValue:function(){},toDatabaseValue:function(){}});f.exports=n},{}],47:[function(e,f,n){var o=e("./Metamodel");n=f.exports=new o,n.Attribute=e("./Attribute"),n.BasicType=e("./BasicType"),n.CollectionAttribute=e("./CollectionAttribute"),n.EmbeddableType=e("./EmbeddableType"),n.EntityType=e("./EntityType"),n.ListAttribute=e("./ListAttribute"),n.ManagedType=e("./ManagedType"),n.MapAttribute=e("./MapAttribute"),n.Metamodel=e("./Metamodel"),n.ModelBuilder=e("./ModelBuilder"),n.PluralAttribute=e("./PluralAttribute"),n.SetAttribute=e("./SetAttribute"),n.SingularAttribute=e("./SingularAttribute"),n.Type=e("./Type"),n.DbIndex=e("./DbIndex")},{"./Attribute":32,"./BasicType":33,"./CollectionAttribute":34,"./DbIndex":35,"./EmbeddableType":36,"./EntityType":37,"./ListAttribute":38,"./ManagedType":39,"./MapAttribute":40,"./Metamodel":41,"./ModelBuilder":42,"./PluralAttribute":43,"./SetAttribute":44,"./SingularAttribute":45,"./Type":46}],48:[function(){Function.prototype.bind=Function.prototype.bind||function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var f=Array.prototype.slice.call(arguments,1),n=this,o=function(){},d=function(){return n.apply(this instanceof o&&e?this:e,f.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,d.prototype=new o,d}},{}],49:[function(e,f){var n=e("./Permission"),o=Object.inherit({read:null,write:null,constructor:function(e){this.read=new n(e),this.write=new n(e)},clear:function(){this.read.clear(),this.write.clear()},isPublicReadAllowed:function(){return this.read.isPublicAllowed()},setPublicReadAllowed:function(){return this.read.setPublicAllowed()},isReadAllowed:function(e){return this.read.isAllowed(e)},isReadDenied:function(e){return this.read.isDenied(e)},allowReadAccess:function(e){return this.read.allowAccess(e),this},denyReadAccess:function(e){return this.read.denyAccess(e),this},deleteReadAccess:function(e){return this.read.deleteAccess(e),this},isPublicWriteAllowed:function(){return this.write.isPublicAllowed()},setPublicWriteAllowed:function(){return this.write.setPublicAllowed()},isWriteAllowed:function(e){return this.write.isAllowed(e)},isWriteDenied:function(e){return this.write.isDenied(e)},allowWriteAccess:function(e){return this.write.allowAccess(e),this},denyWriteAccess:function(e){return this.write.denyAccess(e),this},deleteWriteAccess:function(e){return this.write.deleteAccess(e),this},toJSON:function(){return{read:this.read,write:this.write}},fromJSON:function(e){this.read.fromJSON(e.read),this.write.fromJSON(e.write)}});f.exports=o},{"./Permission":53}],50:[function(e,f){var n=e("../message"),o=e("../connector/Message").StatusCode,d=Object.inherit({_connector:null,_handler:null,_code:null,_isLoaded:!1,constructor:function(){this._handler={},this._code={}},connected:function(e){this._connector=e},functionToString:function(e){if(!e)return"";var f=e.toString();return f=f.substring(f.indexOf("{")+1,f.lastIndexOf("}")),"\n"==f.charAt(0)&&(f=f.substring(1)),"\n"==f.charAt(f.length-1)&&(f=f.substring(0,f.length-1)),f},stringToFunction:function(e){return new Function("db",e)},setHandler:function(e,f,n){this._handler[e]=this._handler[e]||{},this._handler[e][f]=Function.isInstance(n)?n:this.stringToFunction(n)},getHandler:function(e,f){var n=this._handler[e]||{},o=n[f];return o?o:null},removeHandler:function(e,f){var n=this._handler[e]||{};delete n[f],0==Object.keys(n).length&&delete this._handler[e]},setCode:function(e,f){this._code[e]=Function.isInstance(f)?f:this.stringToFunction(f)},getCode:function(e){var f=this._code[e];return f?f:null},removeCode:function(e){delete this._code[e]},loadInsert:function(e,f){return this._loadHandler(e.name,"insert",f)},saveInsert:function(e,f,n){return this._saveHandler(e.name,"insert",f,n)},deleteInsert:function(e,f){return this._deleteHandler(e.name,"insert",f)},loadUpdate:function(e,f){return this._loadHandler(e.name,"update",f)},saveUpdate:function(e,f,n){return this._saveHandler(e.name,"update",f,n)},deleteUpdate:function(e,f){return this._deleteHandler(e.name,"update",f)},loadDelete:function(e,f){return this._loadHandler(e.name,"delete",f)},saveDelete:function(e,f,n){return this._saveHandler(e.name,"delete",f,n)},deleteDelete:function(e,f){return this._deleteHandler(e.name,"delete",f)},loadValidate:function(e,f){return this._loadHandler(e.name,"validate",f).then(function(){return e.validationCode=this.getHandler(e.name,"validate"),e.validationCode}.bind(this))},saveValidate:function(e,f,n){return this._saveHandler(e.name,"validate",f,n).then(function(){return e.validationCode=this._handler[e.name].validate,e.validationCode}.bind(this))},deleteValidate:function(e,f){return this._deleteHandler(e.name,"validate",f).then(function(){e.validationCode=null})},saveCode:function(e,f,o){var d=new n.SetBaqendCode(e,this.functionToString(f));return d.withAuthorizationToken(o),this._connector.send(d).then(function(e){return this.stringToFunction(e.response.entity)}.bind(this))},loadCode:function(e,f){var d=new n.GetBaqendCode(e);return d.withAuthorizationToken(f),this._connector.send(d).then(function(e){return this.stringToFunction(e.response.entity)}.bind(this),function(e){if(e.statusCode==o.OBJECT_NOT_FOUND)return null;throw e})},deleteCode:function(e,f){var o=new n.DeleteBaqendCode(e);return o.withAuthorizationToken(f),this._connector.send(o).then(function(){this.setCode(e,"")}.bind(this))},callCode:function(e,f,o,d){var i=this.getCode(e);if(i)return new Promise(function(e){e(i.call(f,d))});var t=new n.CallBaqendCode(e,f);return t.withAuthorizationToken(o),this._connector.send(t).then(function(e){return e.response.entity})},loadResources:function(e){var f=new n.GetAllCodeResources;return f.withAuthorizationToken(e),this._connector.send(f).then(function(e){return e.response.entity})},_saveHandler:function(e,f,n,o){return this._saveLoadHandler(e,f,n,o)},_loadHandler:function(e,f,n){return this._saveLoadHandler(e,f,null,n)},_saveLoadHandler:function(e,f,d,i){var t=null===d?new n.GetBaqendHandler(e,f):new n.SetBaqendHandler(e,f,this.functionToString(d));return t.withAuthorizationToken(i),this._connector.send(t).then(function(n){return this.setHandler(e,f,n.response.entity),this.getHandler(e,f)}.bind(this),function(e){if(e.statusCode==o.OBJECT_NOT_FOUND)return null;throw e})},_deleteHandler:function(e,f,o){var d=new n.DeleteBaqendHandler(e,f);return d.withAuthorizationToken(o),this._connector.send(d).then(function(){this.removeHandler(e,f)}.bind(this))}});f.exports=d},{"../connector/Message":19,"../message":31}],51:[function(e,f){var n=Trait.inherit({_isLocked:!1,_readyPromise:Promise.resolve(null),_deferred:null,get isReady(){return!this._isLocked},ready:function(e){var f=this;return this._readyPromise.then(function(){return f},function(){return f}).then(e)},withLock:function(e){if(this._isLocked)throw new Error("Current operation has not been finished.");return this._isLocked=!0,this._readyPromise=e().then(function(e){return this._isLocked=!1,e}.bind(this),function(e){throw this._isLocked=!1,e}.bind(this))},lock:function(){if(this._isLocked)throw new Error("There is a lock acquired currently.");this._isLocked=!0;var e=this._deferred={};return e.promise=new Promise(function(f,n){e.resolve=f,e.reject=n}),this._readyPromise=e.promise},unlock:function(){if(!this._deferred)throw new Error("There is no lock acquired.");this._isLocked=!1,this._deferred.resolve(this),this._deferred=null}});f.exports=n},{}],52:[function(e,f){var n=e("../error/PersistentError"),o=e("./Acl"),d=e("./Lockable"),i=Object.inherit(d,{extend:{Type:{UNAVAILABLE:-1,PERSISTENT:0,DIRTY:1},get:function(e){return e&&e._metadata||null},getRoot:function(e){var f=e&&e._metadata;return f&&f._root!=e&&(f=f._root&&f._root._metadata),f},readAccess:function(e){var f=i.getRoot(e);f&&f.readAccess()},writeAccess:function(e){var f=i.getRoot(e);f&&f.writeAccess()}},get db(){return this._db?this._db:this._db=e("../")},set db(e){if(this._db)throw new Error("DB has already been set.");this._db=e},get type(){if(this._type)return this._type;if(!this.isAttached)return null;var e=this.db.metamodel.entity(this._root.constructor);return e&&(this._type=e),e},get bucket(){return this.type&&this.type.name},get ref(){return this.isAttached&&this.id?"/db/"+this.bucket+"/"+encodeURIComponent(this.id):null},get isAttached(){return!!this._db},get isAvailable(){return this._state>i.Type.UNAVAILABLE},get isPersistent(){return this._state==i.Type.PERSISTENT},get isDirty(){return this._state==i.Type.DIRTY},get acl(){var e=new o(this);return Object.defineProperty(this,"acl",{value:e}),e},_root:null,_db:null,_type:null,id:null,version:null,constructor:function t(e){this._root=e,this._state=t.Type.DIRTY,this._enabled=!0},readAccess:function(){if(this._enabled&&!this.isAvailable)throw new n("This object "+this.bucket+"/"+this.id+" is not available.")},writeAccess:function(){if(this._enabled){if(!this.isAvailable)throw new n("This object "+this.bucket+"/"+this.id+" is not available.");this.setDirty()}},setUnavailable:function(){this._state=i.Type.UNAVAILABLE},setPersistent:function(){this._state=i.Type.PERSISTENT},setDirty:function(){this._state=i.Type.DIRTY},setRemoved:function(){this.setDirty(),this.version=null},getDatabaseObjectInfo:function(e){var f={bucket:this.type.name};return this.id&&(f.id=this.id),!e&&this.version&&(f.version=this.version),this.db.transaction.isActive&&(f.transaction="/transaction/"+this.db.transaction.tid),f.acl=this.acl,f},setDatabaseObjectInfo:function(e){this.id||(this.id=e.id),e.version&&(this.version=e.version),this.acl.fromJSON(e.acl||{})},getDatabaseObject:function(e,f){this._enabled=!1;var n=this.type.toDatabaseValue(this,this._root);return this._enabled=!0,this.isAttached&&!f&&(n._objectInfo=this.getDatabaseObjectInfo(e)),n},setDatabaseObject:function(e){e._objectInfo&&this.setDatabaseObjectInfo(e._objectInfo),this._enabled=!1,this.type.fromDatabaseValue(this,e,this._root),this._enabled=!0}});f.exports=i},{"../":30,"../error/PersistentError":27,"./Acl":49,"./Lockable":51}],53:[function(e,f){var n=Object.inherit({_metadata:null,_rules:null,constructor:function(e){this._rules={},this._metadata=e},allRules:function(){return Object.keys(this._rules)},clear:function(){this._metadata&&this._metadata.writeAccess(),this._rules={}},isPublicAllowed:function(){for(var e in this._rules)if("allow"==this._rules[e])return!1;return!0},setPublicAllowed:function(){this._metadata&&this._metadata.writeAccess();for(var e in this._rules)"allow"==this._rules[e]&&delete this._rules[e]},getRule:function(e){return this._rules[this._getRef(e)]},isAllowed:function(e){return"allow"==this._rules[this._getRef(e)]},isDenied:function(e){return"deny"==this._rules[this._getRef(e)]},allowAccess:function(e){return this._metadata&&this._metadata.writeAccess(),this._rules[this._getRef(e)]="allow",this},denyAccess:function(e){return this._metadata&&this._metadata.writeAccess(),this._rules[this._getRef(e)]="deny",this},deleteAccess:function(e){return this._metadata&&this._metadata.writeAccess(),delete this._rules[this._getRef(e)],this},toJSON:function(){return this._rules},fromJSON:function(e){this._rules=e},_getRef:function(e){if(String.isInstance(e)||(e=e._metadata.ref),e.indexOf("/db/User/")||e.indexOf("/db/Role/"))return e;throw new TypeError("The given object isn't a user, role or a valid reference.")}});f.exports=n},{}],54:[function(e,f){var n=Object.inherit({fields:null,get isValid(){for(var e in this.fields)if(!this.fields[e].isValid)return!1;return!0},constructor:function(){this.fields={}},toJSON:function(){var e={};for(var f in this.fields)e[f]=this.fields[f].toJSON();return e}});f.exports=n},{}],55:[function(e,f){var n=e("validator"),o=Object.inherit({extend:{initialize:function(){Object.keys(n).forEach(function(e){"function"==typeof n[e]&&"toString"!==e&&"toDate"!==e&&"extend"!==e&&"init"!==e&&(this.prototype[e]=function(f){return this._callMethod(e,f||e,Array.prototype.slice.call(arguments,f?1:0))})}.bind(this))}},key:null,errors:null,_entity:null,get value(){return this._entity[this.key]},get isValid(){return 0==this.errors.length},is:function(e,f){return Function.isInstance(e)&&(f=e,e="is"),f(this.value,n)===!1&&this.errors.push(e),this},constructor:function(e,f){this.key=e,this._entity=f,this.errors=[]},_callMethod:function(e,f,o){return o=o||[],o.unshift(this.value),n[e].apply(this,o)===!1&&this.errors.push(f),this},toString:function(){return this.value},toJSON:function(){return{isValid:this.isValid,errors:this.errors}}});f.exports=o},{validator:60}],56:[function(e,f,n){n.Metadata=e("./Metadata"),n.Permission=e("./Permission"),n.Acl=e("./Acl"),n.Validator=e("./Validator"),n.ValidationResult=e("./ValidationResult"),n.Code=e("./Code"),n.Lockable=e("./Lockable"),n.uuid=e("node-uuid").v4},{"./Acl":49,"./Code":50,"./Lockable":51,"./Metadata":52,"./Permission":53,"./ValidationResult":54,"./Validator":55,"node-uuid":59}],57:[function(){!function(e){var f=Object.getPrototypeOf({constructor:String})==String.prototype;Function.prototype.extend||(Function.prototype.extend=function(e,f){f||(f=e,e=this);for(var n in f)f.hasOwnProperty(n)&&(e[n]=f[n]);return e}),Object.extend(Function.prototype,{linearizedTypes:[Object],inherit:function(){for(var e=arguments[arguments.length-1],f=e.hasOwnProperty("constructor")?e.constructor:function(e){return this instanceof f?void(this.initialize&&(arguments.length?this.initialize.apply(this,arguments):this.initialize())):f.asInstance(e)},n=Object.createPrototypeChain(f,this,Array.prototype.slice.call(arguments,0,arguments.length-1)),o=Object.getOwnPropertyNames(e),d=0;d<o.length;++d){var i=o[d],t=!1;if(Object.properties.hasOwnProperty(i)&&(t=Object.properties[i](n,e,i)),!t){var l=Object.getOwnPropertyDescriptor(e,i);if(l.value){var u=l.value;u instanceof Function?/this\.superCall/.test(u.toString())&&(l.value=Object.createSuperCallWrapper(f,i,u)):u&&(u.hasOwnProperty("get")||u.hasOwnProperty("value"))&&(l=u)}Object.defineProperty(n,i,l)}}return f.initialize&&f.initialize(),f},isA:function(e){return this.prototype instanceof e||-1!=this.linearizedTypes.lastIndexOf(e)},isInstance:function(e){return null===e||void 0===e?!1:Object(e)instanceof this||-1!=o(e).linearizedTypes.lastIndexOf(this)},asInstance:function(e){return this.isInstance(e)?e:this.conv(e)},conv:function(){return null}}),Object.extend({properties:{},cloneOwnProperties:function(e,f){for(var n=Object.getOwnPropertyNames(f),o=0;o<n.length;++o){var d=n[o];if("__proto__"!=d){var i=Object.getOwnPropertyDescriptor(f,d);Object.defineProperty(e,d,i)}}},createPrototypeChain:function(e,n,o){for(var i,t=n.prototype,l=n.linearizedTypes.slice(),u=n.prototypeChain?n.prototypeChain.slice():[t],p=0;i=o[p];++p){if(!(i.prototype instanceof d))throw new TypeError("Only traits can be mixed in.");for(var s,y=i.linearizedTypes,c=0;s=y[c];++c)-1==l.indexOf(s)&&s!=d&&(t=Object.create(t),Object.cloneOwnProperties(t,s.wrappedPrototype?s.wrappedPrototype:s.prototype),t.constructor=s,l.push(s),u.push(t))}return t=Object.create(t),t.constructor=e,l.push(e),u.push(t),f?(e.wrappedPrototype=t,e.prototype=Object.create(t)):e.prototype=t,e.linearizedTypes=l,e.prototypeChain=u,t},createSuperCallWrapper:function(e,f,n){var d=function(){var n=o(this),d=n.linearizedTypes.lastIndexOf(e);if(-1==d)throw new ReferenceError("superCall can't determine any super method");var i=n.prototypeChain[d-1];return"initialize"!=f||i[f]?arguments.length?i[f].apply(this,arguments):i[f].call(this):void 0};return function(){var e=this.superCall;this.superCall=d;try{return arguments.length?n.apply(this,arguments):n.call(this)}finally{e?this.superCall=e:delete this.superCall}}}}),Object.extend(Object.properties,{initialize:function(e,f){var n=f.initialize,i=/this\.superCall/.test(n.toString());if(e instanceof d){if(i)throw new TypeError("Trait constructors can not call super constructors directly.");f.initialize=function(){arguments.length?this.superCall.apply(this,arguments):this.superCall.call(this),n.call(this)}}else i||o(e)==Object||(f.initialize=function(){this.superCall.call(this),arguments.length?n.apply(this,arguments):n.call(this)})},extend:function(e,f){return Object.extend(e.constructor,f.extend),!0}});for(var n,o=function(e){return null===e||void 0===e?e:Object.getPrototypeOf(Object(e)).constructor},d=Object.inherit({}),i=(d.inherit({extend:{initialize:function(){try{Object.defineProperty(this.prototype,"bind",{get:function(){return this.bind=i.create(this)},set:function(e){Object.defineProperty(this,"bind",{value:e})},configurable:!0}),this.Object=Object.inherit({initialize:function(e){this.self=e}})}catch(e){this.Object=Object.inherit({initialize:function(e){this.self=e;var f=this;i.each(e,function(e,n){f[e]=n.bind(f.self)})}})}},create:function(e){if(!e.constructor.Bind)try{var f={};i.each(e,function(e,n){f[e]={get:function(){return this[e]=n.bind(this.self)},set:function(f){Object.defineProperty(this,e,{value:f})},configurable:!0}}),e.constructor.Bind=i.Object.inherit(f)}catch(n){e.constructor.Bind=i.Object.inherit({})}return new e.constructor.Bind(e)},each:function(e,f){var n=Object.getPrototypeOf(e);for(var o in n){var d=n[o];"initialize"!=o&&d instanceof Function&&f(o,d)}}},initialize:function(){"bind"in this||(this.bind=i.create(this))}})),t=[Boolean,Number,String,Function,RegExp,Error],l=0;n=t[l];++l)n.conv=n;Date.conv=function(e){return new Date(e)},Array.conv=function(e){return Array.prototype.slice.call(e)},Array.prototype.initialize=function(){for(var e=0;e<arguments.length;++e)this[e]=arguments[e];this.length=arguments.length},Error.prototype.initialize=function(e){var f=(new Error).stack||"Error";f=f.substring(f.indexOf("\n")+1),this.stack=e+"\n"+f,this.message=e},TypeError instanceof Error&&(Error.prototype.isInstance=Error.isInstance,Error.prototype.asInstance=Error.asInstance,Error.prototype.conv=Error.conv),Object.extend(e,{classOf:o,Trait:d,Bind:i})}("undefined"!=typeof window?window:global)},{}],58:[function(e){!function f(n,o,d){function i(l,u){if(!o[l]){if(!n[l]){var p="function"==typeof e&&e;if(!u&&p)return p(l,!0);if(t)return t(l,!0);var s=new Error("Cannot find module '"+l+"'");throw s.code="MODULE_NOT_FOUND",s}var y=o[l]={exports:{}};n[l][0].call(y.exports,function(e){var f=n[l][1][e];return i(f?f:e)},y,y.exports,f,n,o,d)}return o[l].exports}for(var t="function"==typeof e&&e,l=0;l<d.length;l++)i(d[l]);return i}({1:[function(e,f){"use strict";function n(){}f.exports=n},{}],2:[function(e,f){"use strict";function n(e){function f(e,f){function o(e){p[f]=e,++s===n&!u&&(u=!0,l.resolve(c,p))}i(e).then(o,function(e){u||(u=!0,l.reject(c,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return d(new TypeError("must be an array"));var n=e.length,u=!1;if(!n)return i([]);for(var p=new Array(n),s=0,y=-1,c=new o(t);++y<n;)f(e[y],y);return c}var o=e("./promise"),d=e("./reject"),i=e("./resolve"),t=e("./INTERNAL"),l=e("./handlers");f.exports=n},{"./INTERNAL":1,"./handlers":3,"./promise":6,"./reject":9,"./resolve":10}],3:[function(e,f,n){"use strict";function o(e){var f=e&&e.then;return e&&"object"==typeof e&&"function"==typeof f?function(){f.apply(e,arguments)}:void 0}var d=e("./tryCatch"),i=e("./resolveThenable"),t=e("./states");n.resolve=function(e,f){var l=d(o,f);if("error"===l.status)return n.reject(e,l.value);var u=l.value;if(u)i.safely(e,u);else{e.state=t.FULFILLED,e.outcome=f;for(var p=-1,s=e.queue.length;++p<s;)e.queue[p].callFulfilled(f)}return e},n.reject=function(e,f){e.state=t.REJECTED,e.outcome=f;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callRejected(f);return e}},{"./resolveThenable":11,"./states":12,"./tryCatch":13}],4:[function(e,f,n){f.exports=n=e("./promise"),n.resolve=e("./resolve"),n.reject=e("./reject"),n.all=e("./all"),n.race=e("./race")},{"./all":2,"./promise":6,"./race":8,"./reject":9,"./resolve":10}],5:[function(e){(function(f){"use strict";"function"!=typeof f.Promise&&(f.Promise=e("./index"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./index":4}],6:[function(e,f){"use strict";function n(e){if(!(this instanceof n))return new n(e);if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=t.PENDING,this.queue=[],this.outcome=void 0,e!==d&&i.safely(this,e)}var o=e("./unwrap"),d=e("./INTERNAL"),i=e("./resolveThenable"),t=e("./states"),l=e("./queueItem");f.exports=n,n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,f){if("function"!=typeof e&&this.state===t.FULFILLED||"function"!=typeof f&&this.state===t.REJECTED)return this;var i=new n(d);if(this.state!==t.PENDING){var u=this.state===t.FULFILLED?e:f;o(i,u,this.outcome)}else this.queue.push(new l(i,e,f));return i}},{"./INTERNAL":1,"./queueItem":7,"./resolveThenable":11,"./states":12,"./unwrap":14}],7:[function(e,f){"use strict";function n(e,f,n){this.promise=e,"function"==typeof f&&(this.onFulfilled=f,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}var o=e("./handlers"),d=e("./unwrap");f.exports=n,n.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},n.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},n.prototype.callRejected=function(e){o.reject(this.promise,e)},n.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)}},{"./handlers":3,"./unwrap":14}],8:[function(e,f){"use strict";function n(e){function f(e){i(e).then(function(e){u||(u=!0,l.resolve(s,e))},function(e){u||(u=!0,l.reject(s,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return d(new TypeError("must be an array"));var n=e.length,u=!1;if(!n)return i([]);for(var p=-1,s=new o(t);++p<n;)f(e[p]);return s}var o=e("./promise"),d=e("./reject"),i=e("./resolve"),t=e("./INTERNAL"),l=e("./handlers");f.exports=n},{"./INTERNAL":1,"./handlers":3,"./promise":6,"./reject":9,"./resolve":10}],9:[function(e,f){"use strict";function n(e){var f=new o(d);return i.reject(f,e)}var o=e("./promise"),d=e("./INTERNAL"),i=e("./handlers");f.exports=n},{"./INTERNAL":1,"./handlers":3,"./promise":6}],10:[function(e,f){"use strict";function n(e){if(e)return e instanceof o?e:i.resolve(new o(d),e);var f=typeof e;switch(f){case"boolean":return t;case"undefined":return u;case"object":return l;case"number":return p;case"string":return s}}var o=e("./promise"),d=e("./INTERNAL"),i=e("./handlers");f.exports=n;var t=i.resolve(new o(d),!1),l=i.resolve(new o(d),null),u=i.resolve(new o(d),void 0),p=i.resolve(new o(d),0),s=i.resolve(new o(d),"")},{"./INTERNAL":1,"./handlers":3,"./promise":6}],11:[function(e,f,n){"use strict";function o(e,f){function n(f){l||(l=!0,d.reject(e,f))}function o(f){l||(l=!0,d.resolve(e,f))}function t(){f(o,n)}var l=!1,u=i(t);"error"===u.status&&n(u.value)}var d=e("./handlers"),i=e("./tryCatch");n.safely=o},{"./handlers":3,"./tryCatch":13}],12:[function(e,f,n){n.REJECTED=["REJECTED"],n.FULFILLED=["FULFILLED"],n.PENDING=["PENDING"]},{}],13:[function(e,f){"use strict";function n(e,f){var n={};try{n.value=e(f),n.status="success"}catch(o){n.status="error",n.value=o}return n}f.exports=n},{}],14:[function(e,f){"use strict";function n(e,f,n){o(function(){var o;try{o=f(n)}catch(i){return d.reject(e,i)}o===e?d.reject(e,new TypeError("Cannot resolve promise with itself")):d.resolve(e,o)})}var o=e("immediate"),d=e("./handlers");f.exports=n},{"./handlers":3,immediate:16}],15:[function(){},{}],16:[function(e,f){"use strict";function n(){d=!0;for(var e,f,n=l.length;n;){for(f=l,l=[],e=-1;++e<n;)f[e]();n=l.length}d=!1}function o(e){1!==l.push(e)||d||i()}for(var d,i,t=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],l=[],u=-1,p=t.length;++u<p;)if(t[u]&&t[u].test&&t[u].test()){i=t[u].install(n);break}f.exports=o},{"./messageChannel":17,"./mutation.js":18,"./nextTick":15,"./stateChange":19,"./timeout":20}],17:[function(e,f,n){(function(e){"use strict";n.test=function(){return e.setImmediate?!1:"undefined"!=typeof e.MessageChannel},n.install=function(f){var n=new e.MessageChannel;return n.port1.onmessage=f,function(){n.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(e,f,n){(function(e){"use strict";var f=e.MutationObserver||e.WebKitMutationObserver;n.test=function(){return f},n.install=function(n){var o=0,d=new f(n),i=e.document.createTextNode("");return d.observe(i,{characterData:!0}),function(){i.data=o=++o%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(e,f,n){(function(e){"use strict";n.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},n.install=function(f){return function(){var n=e.document.createElement("script");return n.onreadystatechange=function(){f(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},e.document.documentElement.appendChild(n),f}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(e,f,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}]},{},[5])},{}],59:[function(f,n){(function(){function f(e,f,n){var o=f&&n||0,d=0;for(f=f||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>d&&(f[o+d++]=r[e])});16>d;)f[o+d++]=0;return f}function o(e,f){var n=f||0,o=a;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]}function d(e,f,n){var d=f&&n||0,i=f||[];e=e||{};var t=null!=e.clockseq?e.clockseq:g,l=null!=e.msecs?e.msecs:(new Date).getTime(),u=null!=e.nsecs?e.nsecs:j+1,p=l-x+(u-j)/1e4;
if(0>p&&null==e.clockseq&&(t=t+1&16383),(0>p||l>x)&&null==e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");x=l,j=u,g=t,l+=122192928e5;var s=(1e4*(268435455&l)+u)%4294967296;i[d++]=s>>>24&255,i[d++]=s>>>16&255,i[d++]=s>>>8&255,i[d++]=255&s;var y=l/4294967296*1e4&268435455;i[d++]=y>>>8&255,i[d++]=255&y,i[d++]=y>>>24&15|16,i[d++]=y>>>16&255,i[d++]=t>>>8|128,i[d++]=255&t;for(var c=e.node||m,a=0;6>a;a++)i[d+a]=c[a];return f?f:o(i)}function i(e,f,n){var d=f&&n||0;"string"==typeof e&&(f="binary"==e?new c(16):null,e=null),e=e||{};var i=e.random||(e.rng||t)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,f)for(var l=0;16>l;l++)f[d+l]=i[l];return f||o(i)}var t,l=this;if("function"==typeof l.require)try{var u=l.require("crypto").randomBytes;t=u&&function(){return u(16)}}catch(p){}if(!t&&l.crypto&&crypto.getRandomValues){var s=new Uint8Array(16);t=function(){return crypto.getRandomValues(s),s}}if(!t){var y=new Array(16);t=function(){for(var e,f=0;16>f;f++)0===(3&f)&&(e=4294967296*Math.random()),y[f]=e>>>((3&f)<<3)&255;return y}}for(var c="function"==typeof l.Buffer?l.Buffer:Array,a=[],r={},w=0;256>w;w++)a[w]=(w+256).toString(16).substr(1),r[a[w]]=w;var b=t(),m=[1|b[0],b[1],b[2],b[3],b[4],b[5]],g=16383&(b[6]<<8|b[7]),x=0,j=0,v=i;if(v.v1=d,v.v4=i,v.parse=f,v.unparse=o,v.BufferClass=c,"undefined"!=typeof n&&n.exports)n.exports=v;else if("function"==typeof e&&e.amd)e(function(){return v});else{var B=l.uuid;v.noConflict=function(){return l.uuid=B,v},l.uuid=v}}).call(this)},{}],60:[function(f,n,o){!function(f,d){"undefined"!=typeof o&&"undefined"!=typeof n?n.exports=d():"function"==typeof e&&"object"==typeof e.amd?e(d):this[f]=d()}("validator",function(e){"use strict";function f(e,f){e=e||{};for(var n in f)"undefined"==typeof e[n]&&(e[n]=f[n]);return e}e={version:"3.30.0"};var n=/((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))/,o=/([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~\.]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~\.]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\s)*/,d=new RegExp("^"+n.source+"$","i"),i=new RegExp("^"+o.source+"<"+n.source+">$","i"),t=/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,l=/^(?:[0-9]{9}X|[0-9]{10})$/,u=/^(?:[0-9]{13})$/,p=/^(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)$/,s=/^::|^::1|^([a-fA-F0-9]{1,4}::?){1,7}([a-fA-F0-9]{1,4})$/,y={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i},c=/^[a-zA-Z]+$/,a=/^[a-zA-Z0-9]+$/,r=/^[-+]?[0-9]+$/,w=/^(?:[-+]?(?:0|[1-9][0-9]*))$/,b=/^(?:[-+]?(?:[0-9]+))?(?:\.[0-9]*)?(?:[eE][\+\-]?(?:[0-9]+))?$/,m=/^[0-9a-fA-F]+$/,g=/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,x=/^[\x00-\x7F]+$/,j=/[^\x00-\x7F]/,v=/[^\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/,B=/[\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/,D=/[\uD800-\uDBFF][\uDC00-\uDFFF]/,h=/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{4})$/,k={"zh-CN":/^(\+?0?86\-?)?1[345789]\d{9}$/,"en-ZA":/^(\+?27|0)\d{9}$/,"en-AU":/^(\+?61|0)4\d{8}/,"fr-FR":/^(\+?33|0)[67]\d{8}$/,"pt-PT":/^(\+351)?9[1236]\d{7}$/};e.extend=function(f,n){e[f]=function(){var f=Array.prototype.slice.call(arguments);return f[0]=e.toString(f[0]),n.apply(e,f)}},e.init=function(){for(var f in e)"function"==typeof e[f]&&"toString"!==f&&"toDate"!==f&&"extend"!==f&&"init"!==f&&e.extend(f,e[f])},e.toString=function(e){return"object"==typeof e&&null!==e&&e.toString?e=e.toString():null===e||"undefined"==typeof e||isNaN(e)&&!e.length?e="":"string"!=typeof e&&(e+=""),e},e.toDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)?e:(e=Date.parse(e),isNaN(e)?null:new Date(e))},e.toFloat=function(e){return parseFloat(e)},e.toInt=function(e,f){return parseInt(e,f||10)},e.toBoolean=function(e,f){return f?"1"===e||"true"===e:"0"!==e&&"false"!==e&&""!==e},e.equals=function(f,n){return f===e.toString(n)},e.contains=function(f,n){return f.indexOf(e.toString(n))>=0},e.matches=function(e,f,n){return"[object RegExp]"!==Object.prototype.toString.call(f)&&(f=new RegExp(f,n)),f.test(e)};var q={allow_display_name:!1};e.isEmail=function(e,n){return n=f(n,q),d.test(e)||n.allow_display_name===!0&&i.test(e)};var z={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,allow_underscores:!1,allow_trailing_dot:!1};e.isURL=function(n,o){if(!n||n.length>=2083)return!1;if(0===n.indexOf("mailto:"))return!1;o=f(o,z);var d,i,t,l,u,p,s,y,c,a,r,w;if(w=n.split("://"),w.length>1){if(d=w.shift(),-1===o.protocols.indexOf(d))return!1}else if(o.require_protocol)return!1;if(n=w.join("://"),w=n.split("#"),n=w.shift(),r=w.join("#"),r&&/\s/.test(r))return!1;if(w=n.split("?"),n=w.shift(),a=w.join("?"),a&&/\s/.test(a))return!1;if(w=n.split("/"),n=w.shift(),c=w.join("/"),c&&/\s/.test(c))return!1;if(w=n.split("@"),w.length>1&&(l=w.shift(),l.indexOf(":")>=0)){if(l=l.split(":"),i=l.shift(),!/^\S+$/.test(i))return!1;if(t=l.join(":"),!/^\S*$/.test(i))return!1}return p=w.join("@"),w=p.split(":"),u=w.shift(),w.length&&(y=w.join(":"),s=parseInt(y,10),!/^[0-9]+$/.test(y)||0>=s||s>65535)?!1:e.isIP(u)||e.isFQDN(u,o)||"localhost"===u?o.host_whitelist&&-1===o.host_whitelist.indexOf(u)?!1:o.host_blacklist&&-1!==o.host_blacklist.indexOf(u)?!1:!0:!1},e.isIP=function(f,n){if(n=e.toString(n),!n)return e.isIP(f,4)||e.isIP(f,6);if("4"===n){if(!p.test(f))return!1;var o=f.split(".").sort(function(e,f){return e-f});return o[3]<=255}return"6"===n&&s.test(f)};var A={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1};e.isFQDN=function(e,n){n=f(n,A),n.allow_trailing_dot&&"."===e[e.length-1]&&(e=e.substring(0,e.length-1));var o=e.split(".");if(n.require_tld){var d=o.pop();if(!o.length||!/^([a-z\u00a1-\uffff]{2,}|xn[a-z0-9-]{2,})$/i.test(d))return!1}for(var i,t=0;t<o.length;t++){if(i=o[t],n.allow_underscores){if(i.indexOf("__")>=0)return!1;i=i.replace(/_/g,"")}if(!/^[a-z\u00a1-\uffff0-9-]+$/i.test(i))return!1;if("-"===i[0]||"-"===i[i.length-1]||i.indexOf("---")>=0)return!1}return!0},e.isAlpha=function(e){return c.test(e)},e.isAlphanumeric=function(e){return a.test(e)},e.isNumeric=function(e){return r.test(e)},e.isHexadecimal=function(e){return m.test(e)},e.isHexColor=function(e){return g.test(e)},e.isLowercase=function(e){return e===e.toLowerCase()},e.isUppercase=function(e){return e===e.toUpperCase()},e.isInt=function(e){return w.test(e)},e.isFloat=function(e){return""!==e&&b.test(e)},e.isDivisibleBy=function(f,n){return e.toFloat(f)%e.toInt(n)===0},e.isNull=function(e){return 0===e.length},e.isLength=function(e,f,n){var o=e.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g)||[],d=e.length-o.length;return d>=f&&("undefined"==typeof n||n>=d)},e.isByteLength=function(e,f,n){return e.length>=f&&("undefined"==typeof n||e.length<=n)},e.isUUID=function(e,f){var n=y[f?f:"all"];return n&&n.test(e)},e.isDate=function(e){return!isNaN(Date.parse(e))},e.isAfter=function(f,n){var o=e.toDate(n||new Date),d=e.toDate(f);return!!(d&&o&&d>o)},e.isBefore=function(f,n){var o=e.toDate(n||new Date),d=e.toDate(f);return d&&o&&o>d},e.isIn=function(f,n){var o;if("[object Array]"===Object.prototype.toString.call(n)){var d=[];for(o in n)d[o]=e.toString(n[o]);return d.indexOf(f)>=0}return"object"==typeof n?n.hasOwnProperty(f):n&&"function"==typeof n.indexOf?n.indexOf(f)>=0:!1},e.isCreditCard=function(e){var f=e.replace(/[^0-9]+/g,"");if(!t.test(f))return!1;for(var n,o,d,i=0,l=f.length-1;l>=0;l--)n=f.substring(l,l+1),o=parseInt(n,10),d?(o*=2,i+=o>=10?o%10+1:o):i+=o,d=!d;return!!(i%10===0?f:!1)},e.isISBN=function(f,n){if(n=e.toString(n),!n)return e.isISBN(f,10)||e.isISBN(f,13);var o,d=f.replace(/[\s-]+/g,""),i=0;if("10"===n){if(!l.test(d))return!1;for(o=0;9>o;o++)i+=(o+1)*d.charAt(o);if(i+="X"===d.charAt(9)?100:10*d.charAt(9),i%11===0)return!!d}else if("13"===n){if(!u.test(d))return!1;var t=[1,3];for(o=0;12>o;o++)i+=t[o%2]*d.charAt(o);if(d.charAt(12)-(10-i%10)%10===0)return!!d}return!1},e.isMobilePhone=function(e,f){return f in k?k[f].test(e):!1},e.isJSON=function(e){try{JSON.parse(e)}catch(f){return!1}return!0},e.isMultibyte=function(e){return j.test(e)},e.isAscii=function(e){return x.test(e)},e.isFullWidth=function(e){return v.test(e)},e.isHalfWidth=function(e){return B.test(e)},e.isVariableWidth=function(e){return v.test(e)&&B.test(e)},e.isSurrogatePair=function(e){return D.test(e)},e.isBase64=function(e){return h.test(e)},e.isMongoId=function(f){return e.isHexadecimal(f)&&24===f.length},e.ltrim=function(e,f){var n=f?new RegExp("^["+f+"]+","g"):/^\s+/g;return e.replace(n,"")},e.rtrim=function(e,f){var n=f?new RegExp("["+f+"]+$","g"):/\s+$/g;return e.replace(n,"")},e.trim=function(e,f){var n=f?new RegExp("^["+f+"]+|["+f+"]+$","g"):/^\s+|\s+$/g;return e.replace(n,"")},e.escape=function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2F;")},e.stripLow=function(f,n){var o=n?"\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F":"\\x00-\\x1F\\x7F";return e.blacklist(f,o)},e.whitelist=function(e,f){return e.replace(new RegExp("[^"+f+"]+","g"),"")},e.blacklist=function(e,f){return e.replace(new RegExp("["+f+"]+","g"),"")};var C={lowercase:!0};return e.normalizeEmail=function(n,o){if(o=f(o,C),!e.isEmail(n))return!1;var d=n.split("@",2);if(d[1]=d[1].toLowerCase(),"gmail.com"===d[1]||"googlemail.com"===d[1]){if(d[0]=d[0].toLowerCase().replace(/\./g,""),"+"===d[0][0])return!1;d[0]=d[0].split("+")[0],d[1]="gmail.com"}else o.lowercase&&(d[0]=d[0].toLowerCase());return d.join("@")},e.init(),e})},{}]},{},[30])(30)});